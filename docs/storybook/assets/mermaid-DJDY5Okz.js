const g=new Set(["end","start","subgraph","class","classDef","click","style","linkStyle","direction","flowchart","graph","if","else","elseif","while","for","function","return","break","continue"]),u=r=>{if(!r||r.trim()==="")return"node_unnamed";let e=r.trim();return g.has(e.toLowerCase())&&(e=`node_${e}`),/^[0-9]/.test(e)&&(e=`_${e}`),e=e.replace(/\s+/g,"_"),e=e.replace(/[^\w\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,"_"),e},f=(r,e)=>{switch(r){case"rectangle":return`[${e}]`;case"diamond":return`{${e}}`;case"rounded":return`(${e})`;case"circle":return`((${e}))`;case"hexagon":return`{{${e}}}`;case"stadium":return`([${e}])`;default:return`[${e}]`}},F=r=>!r||r.trim()===""?r:/^\d+$/.test(r.trim())?r.trim():/^[a-zA-Z0-9\-_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF\s]+$/.test(r)?r:`"${r.replace(/"/g,'\\"')}"`,w=(r="arrow",e)=>{const a=e&&e.trim()!=="",s=a?F(e):"";switch(r){case"arrow":return a?` -->|${s}| `:" --> ";case"thick":return a?` ==>|${s}| `:" ==> ";case"dotted":return a?` -. ${s} .-> `:" -.-> ";case"invisible":return a?` ~~~|${s}| `:" ~~~ ";case"bidirectional":return a?` <-->|${s}| `:" <--> ";case"bidirectional-thick":return a?` <==${s}==> `:" <==> ";default:return a?` -->|${s}| `:" --> "}},A=r=>{switch(r){case"arrow":return"→";case"thick":return"⇒";case"dotted":return"⇢";case"invisible":return"～";case"bidirectional":return"↔";case"bidirectional-thick":return"⇔";default:return"→"}},y=r=>{switch(r){case"arrow":return"通常の矢印 (->)";case"thick":return"太い矢印 (==>)";case"dotted":return"点線矢印 (-.->)";case"invisible":return"非表示 (~~~)";case"bidirectional":return"双方向矢印 (<->)";case"bidirectional-thick":return"太い双方向矢印 (<==>)";default:return"通常の矢印 (->)"}},E=(r,e="TD")=>{let a=`flowchart ${e}
`;return r.nodes.forEach(s=>{const i=s.data.variableName||`node${s.id}`,t=u(i),n=s.data.shapeType||"rectangle",o=s.data.label||"",c=f(n,o);a+=`    ${t}${c}
`}),r.edges.forEach(s=>{var n,o;const i=r.nodes.find(c=>c.id===s.source),t=r.nodes.find(c=>c.id===s.target);if(i&&t){const c=u(i.data.variableName||`node${i.id}`),$=u(t.data.variableName||`node${t.id}`),p=(n=s.data)==null?void 0:n.label,l=((o=s.data)==null?void 0:o.arrowType)||"arrow",h=w(l,p);a+=`    ${c}${h}${$}
`}}),a},b=r=>{const e={nodes:[],edges:[]};if(!r||r.trim()==="")return e;const s=r.split(`
`).map(t=>t.trim()).filter(t=>t).filter(t=>!t.startsWith("flowchart")&&!t.startsWith("graph")),i=new Map;for(const t of s){const n=m(t);n&&i.set(n.id,n)}for(const t of s){const n=x(t);if(n){if(!i.has(n.source)){const o=d(t,n.source);i.set(n.source,o)}if(!i.has(n.target)){const o=d(t,n.target);i.set(n.target,o)}e.edges.push(n)}}return e.nodes=Array.from(i.values()),e},d=(r,e)=>{const a=[{pattern:"\\[([^\\]]*)\\]",shape:"rectangle"},{pattern:"\\(\\(([^\\)]*)\\)\\)",shape:"circle"},{pattern:"\\{\\{([^\\}]*)\\}\\}",shape:"hexagon"},{pattern:"\\(\\[([^\\]]*)\\]\\)",shape:"stadium"},{pattern:"\\(([^\\)]*)\\)",shape:"rounded"},{pattern:"\\{([^\\}]*)\\}",shape:"diamond"}];for(const{pattern:s,shape:i}of a){const t=new RegExp(`${e}${s}`),n=r.match(t);if(n)return{id:e,variableName:e,label:n[1]||e,shapeType:i}}return{id:e,variableName:e,label:e,shapeType:"rectangle"}},m=r=>{if(r.includes("-->")||r.includes("==>")||r.includes("-.->")||r.includes("~~~")||r.includes("<-->")||r.includes("<==>"))return null;const e=[{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\[([^\]]*)\]$/,shape:"rectangle"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(\(([^)]*)\)\)$/,shape:"circle"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\{\{([^}]*)\}\}$/,shape:"hexagon"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(\[([^\]]*)\]\)$/,shape:"stadium"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(([^)]*)\)$/,shape:"rounded"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\{([^}]*)\}$/,shape:"diamond"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)$/,shape:"rectangle"}];for(const a of e){const s=r.match(a.regex);if(s){const i=s[1],t=s[2]!==void 0?s[2]:i;if(i.includes(" "))continue;return{id:i,variableName:i,label:t,shapeType:a.shape}}}return null},x=r=>{const e="[a-zA-Z0-9_\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF]+",a="(?:\\[[^\\]]*\\]|\\([^)]*\\)|\\{[^}]*\\}|\\(\\([^)]*\\)\\)|\\{\\{[^}]*\\}\\}|\\(\\[[^\\]]*\\]\\))?",s=[{regex:new RegExp(`^(${e})${a}\\s*<==(.+)==>\\s*(${e})${a}$`),arrowType:"bidirectional-thick",labelPosition:"middle"},{regex:new RegExp(`^(${e})${a}\\s*<==>\\s*(${e})${a}$`),arrowType:"bidirectional-thick"},{regex:new RegExp(`^(${e})${a}\\s*<-->\\s*\\|\\s*([^|]*)\\s*\\|\\s*(${e})${a}$`),arrowType:"bidirectional"},{regex:new RegExp(`^(${e})${a}\\s*<-->\\s*(${e})${a}$`),arrowType:"bidirectional"},{regex:new RegExp(`^(${e})${a}\\s*-\\.\\s*(.+?)\\s*\\.-\\s*>\\s*(${e})${a}$`),arrowType:"dotted",labelPosition:"sides"},{regex:new RegExp(`^(${e})${a}\\s*-\\.\\s*->\\s*(${e})${a}$`),arrowType:"dotted"},{regex:new RegExp(`^(${e})${a}\\s*==>\\s*\\|\\s*([^|]*)\\s*\\|\\s*(${e})${a}$`),arrowType:"thick"},{regex:new RegExp(`^(${e})${a}\\s*==>\\s*(${e})${a}$`),arrowType:"thick"},{regex:new RegExp(`^(${e})${a}\\s*-->\\s*\\|\\s*([^|]*)\\s*\\|\\s*(${e})${a}$`),arrowType:"arrow"},{regex:new RegExp(`^(${e})${a}\\s*-->\\s*(${e})${a}$`),arrowType:"arrow"}];for(const i of s){const t=r.match(i.regex);if(t){let n,o,c="";return i.arrowType==="bidirectional-thick"&&t.length>=4&&t[2]&&t[2].trim()!==""||i.labelPosition==="sides"&&t.length>=4||t.length===4?(n=t[1],c=t[2].trim(),o=t[3]):(n=t[1],o=t[2]),{id:`${n}-${o}`,source:n,target:o,label:c,arrowType:i.arrowType}}}return null};export{y as a,E as b,f,A as g,b as p};
