"use strict";(self.webpackChunkmermaid_editor=self.webpackChunkmermaid_editor||[]).push([[707],{"./features/flowchart/components/editor/label-editor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{y:()=>LabelEditor});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@14.1.0_@babel+core@7.28.3_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/jsx-runtime.js"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+input@1.0.56_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/input/dist/chunk-2SDIXUVN.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+typography@1.1.9_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/typography/dist/chunk-HZUFQ4E7.mjs");const LabelEditor=({value,isEditing,onDoubleClick,onChange,onKeyDown,onCompositionStart,onCompositionEnd,onBlur})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:isEditing?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_1__.p,{value,onChange,onKeyDown,onCompositionStart,onCompositionEnd,onBlur,size:"sm",autoFocus:!0,textAlign:"center",w:"full",h:"24px",p:1,fontSize:"sm",border:"none",bg:"transparent",_focus:{boxShadow:"none",outline:"none"}}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_2__.E,{w:"full",fontSize:"sm",fontWeight:"medium",wordBreak:"break-word",lineHeight:"1.2",onDoubleClick,children:value})});LabelEditor.__docgenInfo={description:"",methods:[],displayName:"LabelEditor"}},"./features/flowchart/components/editor/variable-name-editor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>VariableNameEditor});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@14.1.0_@babel+core@7.28.3_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/jsx-runtime.js"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+input@1.0.56_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/input/dist/chunk-2SDIXUVN.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+layouts@1.4.3_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/layouts/dist/chunk-ZJJ7XTJB.mjs"),_hooks_mermaid__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./features/flowchart/hooks/mermaid.ts");const VariableNameEditor=({value,isEditing,shapeType,onClick,onChange,onKeyDown,onCompositionStart,onCompositionEnd,onBlur})=>{const displayValue=(0,_hooks_mermaid__WEBPACK_IMPORTED_MODULE_3__.CP)(shapeType||"rectangle",value);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_2__.a,{position:"absolute",top:"-12px",left:"0px",bg:"blue.500",color:"white",px:1,py:"1px",borderRadius:"sm",fontSize:"10px",fontWeight:"medium",cursor:"pointer",onClick,_hover:{bg:"blue.600"},zIndex:10,children:isEditing?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_1__.p,{value,onChange,onKeyDown,onCompositionStart,onCompositionEnd,onBlur,size:"xs",autoFocus:!0,w:"60px",h:"16px",p:0,fontSize:"10px",bg:"white",color:"black",border:"none",_focus:{boxShadow:"none",outline:"none"}}):displayValue})};VariableNameEditor.__docgenInfo={description:"",methods:[],displayName:"VariableNameEditor"}},"./features/flowchart/components/node/node-menu.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M:()=>NodeMenu});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@14.1.0_@babel+core@7.28.3_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/jsx-runtime.js"),_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+lucide@1.10.5_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/lucide/dist/chunk-VBV4TRPR.mjs"),_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+lucide@1.10.5_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/lucide/dist/chunk-WDD7TD4N.mjs"),_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+lucide@1.10.5_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/lucide/dist/chunk-WSTR2DDA.mjs"),_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+lucide@1.10.5_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/lucide/dist/chunk-OQVTA2AW.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+button@1.0.59_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/button/dist/chunk-QQERBTQW.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-HWUNOGPF.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-ZG5BKE24.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-BIEYDHFO.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-3UTYG3XF.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-D2UJVOJ7.mjs"),_shape_selector__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./features/flowchart/components/node/shape-selector.tsx");const NodeMenu=({onEdit,onEditVariableName,onDelete,onShapeChange,currentShape})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_8__.W,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_9__.I,{size:"xs",position:"absolute",top:0,right:0,as:_yamada_ui_react__WEBPACK_IMPORTED_MODULE_5__.K,icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_4__.s,{fontSize:"2xl"}),variant:"ghost","aria-label":"ノードの操作メニューを開く"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_6__.c,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_10__.Dr,{icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_3__.c,{fontSize:"xl"}),onClick:onEdit,children:"ラベル編集"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_10__.Dr,{icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_2__.g,{fontSize:"xl"}),onClick:onEditVariableName,children:"変数名編集"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_7__.b,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_shape_selector__WEBPACK_IMPORTED_MODULE_11__.p,{currentShape,onShapeChange}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_7__.b,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_10__.Dr,{color:"danger",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_1__.u,{fontSize:"xl",color:"danger"}),onClick:onDelete,children:"削除"})]})]});NodeMenu.__docgenInfo={description:"",methods:[],displayName:"NodeMenu",props:{onEdit:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onEditVariableName:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onDelete:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onShapeChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(shapeType: string) => void",signature:{arguments:[{type:{name:"string"},name:"shapeType"}],return:{name:"void"}}},description:""},currentShape:{required:!1,tsType:{name:"string"},description:""}}}},"./features/flowchart/components/node/shape-selector.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>ShapeSelector});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@14.1.0_@babel+core@7.28.3_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/jsx-runtime.js"),_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+lucide@1.10.5_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/lucide/dist/chunk-6YVVONE2.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-HWUNOGPF.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+typography@1.1.9_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/typography/dist/chunk-HZUFQ4E7.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-BIEYDHFO.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-3UTYG3XF.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+layouts@1.4.3_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/layouts/dist/chunk-ZJJ7XTJB.mjs"),_yamada_ui_react__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/@yamada-ui+menu@1.5.7_@emotion+is-prop-valid@1.3.1_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/menu/dist/chunk-D2UJVOJ7.mjs"),_types_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./features/flowchart/types/types.ts");const ShapeSelector=({currentShape,onShapeChange})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_4__.W,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_5__.I,{as:_yamada_ui_react__WEBPACK_IMPORTED_MODULE_7__.Dr,icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_lucide__WEBPACK_IMPORTED_MODULE_1__.C,{fontSize:"xl"}),children:"ノード形状"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_2__.c,{children:_types_types__WEBPACK_IMPORTED_MODULE_8__.LK.map(shape=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_7__.Dr,{onClick:()=>null==onShapeChange?void 0:onShapeChange(shape.type),bg:currentShape===shape.type?"primary.50":void 0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_6__.a,{display:"flex",alignItems:"center",justifyContent:"space-between",w:"full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_3__.E,{children:shape.label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_yamada_ui_react__WEBPACK_IMPORTED_MODULE_3__.E,{fontSize:"sm",color:"muted",fontFamily:"mono",children:shape.symbol})]})},shape.type))})]});ShapeSelector.__docgenInfo={description:"",methods:[],displayName:"ShapeSelector",props:{currentShape:{required:!1,tsType:{name:"string"},description:""},onShapeChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(shapeType: string) => void",signature:{arguments:[{type:{name:"string"},name:"shapeType"}],return:{name:"void"}}},description:""}}}},"./features/flowchart/hooks/mermaid.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{CP:()=>formatMermaidShape,I$:()=>generateMermaidCode,UF:()=>getArrowTypeSymbol,UY:()=>parseMermaidCode,Vc:()=>getArrowTypeDisplayName});const RESERVED_WORDS=new Set(["end","start","subgraph","class","classDef","click","style","linkStyle","direction","flowchart","graph","if","else","elseif","while","for","function","return","break","continue"]),getSafeVariableName=variableName=>{if(!variableName||""===variableName.trim())return"node_unnamed";let safeName=variableName.trim();return RESERVED_WORDS.has(safeName.toLowerCase())&&(safeName=`node_${safeName}`),/^[0-9]/.test(safeName)&&(safeName=`_${safeName}`),safeName=safeName.replace(/\s+/g,"_"),safeName=safeName.replace(/[^\w\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,"_"),safeName},formatMermaidShape=(shapeType,label)=>{switch(shapeType){case"rectangle":default:return`[${label}]`;case"diamond":return`{${label}}`;case"rounded":return`(${label})`;case"circle":return`((${label}))`;case"hexagon":return`{{${label}}}`;case"stadium":return`([${label}])`}},getArrowTypeSymbol=arrowType=>{switch(arrowType){case"arrow":default:return"→";case"thick":return"⇒";case"dotted":return"⇢";case"invisible":return"～";case"bidirectional":return"↔";case"bidirectional-thick":return"⇔"}},getArrowTypeDisplayName=arrowType=>{switch(arrowType){case"arrow":default:return"通常の矢印 (->)";case"thick":return"太い矢印 (==>)";case"dotted":return"点線矢印 (-.->)";case"invisible":return"非表示 (~~~)";case"bidirectional":return"双方向矢印 (<->)";case"bidirectional-thick":return"太い双方向矢印 (<==>)"}},generateMermaidCode=(flowData,direction="TD")=>{let code=`flowchart ${direction}\n`;return flowData.nodes.forEach(node=>{const variableName=node.data.variableName||`node${node.id}`,safeVariableName=getSafeVariableName(variableName),shapeType=node.data.shapeType||"rectangle",label=node.data.label||"",shapeCode=formatMermaidShape(shapeType,label);code+=`    ${safeVariableName}${shapeCode}\n`}),flowData.edges.forEach(edge=>{const sourceNode=flowData.nodes.find(node=>node.id===edge.source),targetNode=flowData.nodes.find(node=>node.id===edge.target);if(sourceNode&&targetNode){var _edge_data,_edge_data1;const sourceVariableName=getSafeVariableName(sourceNode.data.variableName||`node${sourceNode.id}`),targetVariableName=getSafeVariableName(targetNode.data.variableName||`node${targetNode.id}`),edgeLabel=null===(_edge_data=edge.data)||void 0===_edge_data?void 0:_edge_data.label,arrowCode=((arrowType="arrow",label)=>{const hasLabel=label&&""!==label.trim(),sanitizedLabel=hasLabel?(label=>label&&""!==label.trim()?/^\d+$/.test(label.trim())?label.trim():/^[a-zA-Z0-9\-_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF\s]+$/.test(label)?label:`"${label.replace(/"/g,'\\"')}"`:label)(label):"";switch(arrowType){case"arrow":default:return hasLabel?` --\x3e|${sanitizedLabel}| `:" --\x3e ";case"thick":return hasLabel?` ==>|${sanitizedLabel}| `:" ==> ";case"dotted":return hasLabel?` -. ${sanitizedLabel} .-> `:" -.-> ";case"invisible":return hasLabel?` ~~~|${sanitizedLabel}| `:" ~~~ ";case"bidirectional":return hasLabel?` <--\x3e|${sanitizedLabel}| `:" <--\x3e ";case"bidirectional-thick":return hasLabel?` <==${sanitizedLabel}==> `:" <==> "}})((null===(_edge_data1=edge.data)||void 0===_edge_data1?void 0:_edge_data1.arrowType)||"arrow",edgeLabel);code+=`    ${sourceVariableName}${arrowCode}${targetVariableName}\n`}}),code},parseMermaidCode=mermaidCode=>{const result={nodes:[],edges:[]};if(!mermaidCode||""===mermaidCode.trim())return result;const contentLines=mermaidCode.split("\n").map(line=>line.trim()).filter(line=>line).filter(line=>!line.startsWith("flowchart")&&!line.startsWith("graph")),nodeRegistry=new Map;for(const line of contentLines){const nodeMatch=parseNodeDefinition(line);nodeMatch&&nodeRegistry.set(nodeMatch.id,nodeMatch)}for(const line of contentLines){const edgeMatch=parseEdgeDefinition(line);if(edgeMatch){if(!nodeRegistry.has(edgeMatch.source)){const sourceNodeInfo=extractNodeFromEdgeLine(line,edgeMatch.source);nodeRegistry.set(edgeMatch.source,sourceNodeInfo)}if(!nodeRegistry.has(edgeMatch.target)){const targetNodeInfo=extractNodeFromEdgeLine(line,edgeMatch.target);nodeRegistry.set(edgeMatch.target,targetNodeInfo)}result.edges.push(edgeMatch)}}return result.nodes=Array.from(nodeRegistry.values()),result},extractNodeFromEdgeLine=(line,nodeId)=>{const shapePatterns=[{pattern:"\\[([^\\]]*)\\]",shape:"rectangle"},{pattern:"\\(\\(([^\\)]*)\\)\\)",shape:"circle"},{pattern:"\\{\\{([^\\}]*)\\}\\}",shape:"hexagon"},{pattern:"\\(\\[([^\\]]*)\\]\\)",shape:"stadium"},{pattern:"\\(([^\\)]*)\\)",shape:"rounded"},{pattern:"\\{([^\\}]*)\\}",shape:"diamond"}];for(const{pattern,shape}of shapePatterns){const regex=new RegExp(`${nodeId}${pattern}`),match=line.match(regex);if(match)return{id:nodeId,variableName:nodeId,label:match[1]||nodeId,shapeType:shape}}return{id:nodeId,variableName:nodeId,label:nodeId,shapeType:"rectangle"}},parseNodeDefinition=line=>{if(line.includes("--\x3e")||line.includes("==>")||line.includes("-.->")||line.includes("~~~")||line.includes("<--\x3e")||line.includes("<==>"))return null;const patterns=[{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\[([^\]]*)\]$/,shape:"rectangle"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(\(([^)]*)\)\)$/,shape:"circle"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\{\{([^}]*)\}\}$/,shape:"hexagon"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(\[([^\]]*)\]\)$/,shape:"stadium"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(([^)]*)\)$/,shape:"rounded"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\{([^}]*)\}$/,shape:"diamond"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)$/,shape:"rectangle"}];for(const pattern of patterns){const match=line.match(pattern.regex);if(match){const id=match[1],label=void 0!==match[2]?match[2]:id;if(id.includes(" "))continue;return{id,variableName:id,label,shapeType:pattern.shape}}}return null},parseEdgeDefinition=line=>{const nodeId="[a-zA-Z0-9_\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF]+",nodeShape="(?:\\[[^\\]]*\\]|\\([^)]*\\)|\\{[^}]*\\}|\\(\\([^)]*\\)\\)|\\{\\{[^}]*\\}\\}|\\(\\[[^\\]]*\\]\\))?",patterns=[{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*<==\\s*(.+?)\\s*==>\\s*(${nodeId})${nodeShape}$`),arrowType:"bidirectional-thick",labelPosition:"middle"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*<==>\\s*(${nodeId})${nodeShape}$`),arrowType:"bidirectional-thick"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*<--\x3e\\s*\\|\\s*([^|]*)\\s*\\|\\s*(${nodeId})${nodeShape}$`),arrowType:"bidirectional"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*<--\\s*(.+?)\\s*--\x3e\\s*(${nodeId})${nodeShape}$`),arrowType:"bidirectional",labelPosition:"middle"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*<--\x3e\\s*(${nodeId})${nodeShape}$`),arrowType:"bidirectional"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*-\\.\\s*(.+?)\\s*\\.->\\s*(${nodeId})${nodeShape}$`),arrowType:"dotted",labelPosition:"sides"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*-\\.\\s*->\\s*(${nodeId})${nodeShape}$`),arrowType:"dotted"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*==>\\s*\\|\\s*([^|]*)\\s*\\|\\s*(${nodeId})${nodeShape}$`),arrowType:"thick"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*==\\s*(.+?)\\s*==>\\s*(${nodeId})${nodeShape}$`),arrowType:"thick"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*==>\\s*(${nodeId})${nodeShape}$`),arrowType:"thick"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*--\x3e\\s*\\|\\s*([^|]*)\\s*\\|\\s*(${nodeId})${nodeShape}$`),arrowType:"arrow"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*--\\s*(.+?)\\s*--\x3e\\s*(${nodeId})${nodeShape}$`),arrowType:"arrow"},{regex:new RegExp(`^(${nodeId})${nodeShape}\\s*--\x3e\\s*(${nodeId})${nodeShape}$`),arrowType:"arrow"}];for(const pattern of patterns){const match=line.match(pattern.regex);if(match){let source,target,label="";return"bidirectional-thick"===pattern.arrowType&&match.length>=4&&match[2]&&""!==match[2].trim()||"sides"===pattern.labelPosition&&match.length>=4||4===match.length?(source=match[1],label=match[2].trim(),target=match[3]):(source=match[1],target=match[2]),{id:`${source}-${target}`,source,target,label,arrowType:pattern.arrowType}}}return null}},"./features/flowchart/stories/node/node-content.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>node_content_stories});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@14.1.0_@babel+core@7.28.3_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/jsx-runtime.js"),chunk_ZJJ7XTJB=(__webpack_require__("./node_modules/.pnpm/@xyflow+react@12.8.2_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@xyflow/react/dist/esm/index.js"),__webpack_require__("./node_modules/.pnpm/@xyflow+system@0.0.66/node_modules/@xyflow/system/dist/esm/index.js"),__webpack_require__("./node_modules/.pnpm/@yamada-ui+layouts@1.4.3_@types+react@18.3.23_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@yamada-ui/layouts/dist/chunk-ZJJ7XTJB.mjs")),react=__webpack_require__("./node_modules/.pnpm/next@14.1.0_@babel+core@7.28.3_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/index.js"),types=__webpack_require__("./features/flowchart/types/types.ts"),label_editor=__webpack_require__("./features/flowchart/components/editor/label-editor.tsx"),variable_name_editor=__webpack_require__("./features/flowchart/components/editor/variable-name-editor.tsx"),node_menu=__webpack_require__("./features/flowchart/components/node/node-menu.tsx");const NodeContent=({data,id})=>{const[isEditingLabel,setIsEditingLabel]=(0,react.useState)(!1),[isEditingVariableName,setIsEditingVariableName]=(0,react.useState)(!1),[label,setLabel]=(0,react.useState)(data.label),[variableName,setVariableName]=(0,react.useState)(data.variableName||`node${id}`),[isComposing,setIsComposing]=(0,react.useState)(!1),lastVariableClickTime=(0,react.useRef)(0),handleLabelDoubleClick=()=>{Date.now()-lastVariableClickTime.current<types.B8.DOUBLE_CLICK_THRESHOLD||(isEditingVariableName&&handleVariableNameSave(),setIsEditingLabel(!0))},handleLabelSave=()=>{setIsEditingLabel(!1),data.onLabelChange&&data.onLabelChange(id,label)},handleVariableNameSave=()=>{setIsEditingVariableName(!1),data.onVariableNameChange&&data.onVariableNameChange(id,variableName)},handleCompositionStart=()=>{setIsComposing(!0)},handleCompositionEnd=()=>{setIsComposing(!1)};return(0,jsx_runtime.jsxs)(chunk_ZJJ7XTJB.a,{bg:"white",border:"2px solid #1a365d",borderRadius:"md",p:2,w:"xs",minH:"6xs",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",cursor:"pointer",onDoubleClick:handleLabelDoubleClick,_hover:{boxShadow:"md"},position:"relative",children:[(0,jsx_runtime.jsx)(variable_name_editor.J,{value:variableName,isEditing:isEditingVariableName,shapeType:data.shapeType,onClick:e=>{e.stopPropagation(),e.preventDefault(),lastVariableClickTime.current=Date.now(),isEditingLabel&&handleLabelSave(),setIsEditingVariableName(!0)},onChange:e=>{setVariableName(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||isComposing?"Escape"===e.key&&(setIsEditingVariableName(!1),setVariableName(data.variableName||`node${id}`)):handleVariableNameSave()},onCompositionStart:handleCompositionStart,onCompositionEnd:handleCompositionEnd,onBlur:handleVariableNameSave}),(0,jsx_runtime.jsx)(node_menu.M,{onDelete:()=>{data.onDelete&&data.onDelete(id)},onEdit:()=>{isEditingVariableName&&handleVariableNameSave(),setIsEditingLabel(!0)},onEditVariableName:()=>{isEditingLabel&&handleLabelSave(),setIsEditingVariableName(!0)},onShapeChange:shapeType=>{var _data_onShapeTypeChange;null===(_data_onShapeTypeChange=data.onShapeTypeChange)||void 0===_data_onShapeTypeChange||_data_onShapeTypeChange.call(data,id,shapeType)},currentShape:data.shapeType||"rectangle"}),(0,jsx_runtime.jsx)(label_editor.y,{value:label,isEditing:isEditingLabel,onDoubleClick:handleLabelDoubleClick,onChange:e=>{setLabel(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||isComposing?"Escape"===e.key&&(setIsEditingLabel(!1),setLabel(data.label)):handleLabelSave()},onCompositionStart:handleCompositionStart,onCompositionEnd:handleCompositionEnd,onBlur:handleLabelSave})]})};NodeContent.__docgenInfo={description:"",methods:[],displayName:"NodeContent"};const node_content_stories={title:"components/node/NodeContent",component:NodeContent},Default={render:()=>(0,jsx_runtime.jsx)(NodeContent,{id:"1",data:{label:"ノードラベル",variableName:"var1",shapeType:"rectangle",onLabelChange:(id,label)=>alert(`ラベル変更: ${id} → ${label}`),onVariableNameChange:(id,name)=>alert(`変数名変更: ${id} → ${name}`),onShapeTypeChange:(id,shape)=>alert(`形状変更: ${id} → ${shape}`),onDelete:id=>alert(`削除: ${id}`)}})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:'{\n  render: () => <NodeContent id="1" data={{\n    label: "ノードラベル",\n    variableName: "var1",\n    shapeType: "rectangle",\n    onLabelChange: (id, label) => alert(`ラベル変更: ${id} → ${label}`),\n    onVariableNameChange: (id, name) => alert(`変数名変更: ${id} → ${name}`),\n    onShapeTypeChange: (id, shape) => alert(`形状変更: ${id} → ${shape}`),\n    onDelete: id => alert(`削除: ${id}`)\n  }} />\n}',...Default.parameters?.docs?.source}}}},"./features/flowchart/types/types.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B8:()=>UI_CONSTANTS,LK:()=>SHAPE_OPTIONS,Qb:()=>ARROW_TYPES});const UI_CONSTANTS={DOUBLE_CLICK_THRESHOLD:300,DEBOUNCE_DELAY:150,IME_COMPOSITION_DELAY:100},ARROW_TYPES=["arrow","thick","dotted","invisible","bidirectional","bidirectional-thick"],SHAPE_OPTIONS=[{type:"rectangle",label:"四角形",symbol:"[ ]"},{type:"diamond",label:"菱形",symbol:"{ }"},{type:"rounded",label:"角丸四角",symbol:"( )"},{type:"circle",label:"円形",symbol:"(( ))"},{type:"hexagon",label:"六角形",symbol:"{{ }}"},{type:"stadium",label:"スタジアム",symbol:"([ ])"}]}}]);