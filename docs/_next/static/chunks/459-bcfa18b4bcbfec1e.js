(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{71459:function(e,t,n){Promise.resolve().then(n.bind(n,78607))},79544:function(e,t,n){"use strict";n.d(t,{f:function(){return l}});var a=n(48983),r=n(61464),o=n(79950);let l=e=>{let{children:t}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Controls,{}),(0,a.jsx)(r.MiniMap,{}),(0,a.jsx)(r.Background,{}),t,(0,a.jsx)(o.K,{})]})}},79950:function(e,t,n){"use strict";n.d(t,{K:function(){return x}});var a=n(48983),r=n(61464),o=n(39971),l=n(20557),s=n(74881),i=n(44331),c=n(11375),d=n(21967),u=n(69452),h=n(27321),p=n(46061);let x=()=>(0,a.jsx)(r.Panel,{position:"top-right",children:(0,a.jsx)(g,{})}),g=()=>(0,a.jsxs)(i.v,{children:[(0,a.jsx)(c.j,{as:d.h,icon:(0,a.jsx)(o.E,{}),size:"sm","aria-label":"コントリビューションメニュー",bg:"gray.600",color:"white",_hover:{bg:"black",textDecoration:"none"}}),(0,a.jsxs)(u.q,{children:[(0,a.jsx)(h.sN,{as:p.r,href:"https://github.com/illionillion/mermaid-editor",target:"_blank",rel:"noopener noreferrer",icon:(0,a.jsx)(l.d,{}),children:"リポジトリを見る"}),(0,a.jsx)(h.sN,{as:p.r,href:"https://github.com/illionillion/mermaid-editor/issues/new/choose",target:"_blank",rel:"noopener noreferrer",icon:(0,a.jsx)(s.E,{}),children:"Issueを作成"})]})]})},52020:function(e,t,n){"use strict";n.d(t,{qi:function(){return d},D5:function(){return v},i9:function(){return y}}),n(79950);var a=n(48983),r=n(96172),o=n(80714),l=n(88614),s=n(78861),i=n(68614),c=n(21967);let d=(0,n(12685).memo)((0,l.forwardRef)((e,t)=>{let{value:n,...l}=e,{hasCopied:d,onCopy:u}=(0,s.useClipboard)(n);return(0,a.jsx)(i.u,{alignItems:"center",bg:"success",display:"inline-flex",h:"8",open:d,label:"Copied!",placement:"left",zIndex:"1000",children:(0,a.jsx)(c.h,{ref:t,size:"sm",variant:"unstyled","aria-label":"Copy the code",alignItems:"center",bg:["neutral.800","neutral.900"],border:"1px solid",borderColor:d?"success":"whiteAlpha.600",color:d?"success":"whiteAlpha.600",display:"flex",icon:d?(0,a.jsx)(r.n,{fontSize:"lg"}):(0,a.jsx)(o.T,{fontSize:"md"}),justifyContent:"center",_hover:{borderColor:d?"success":"whiteAlpha.800",color:d?"success":"whiteAlpha.800"},...l,onClick:u})})}));var u=n(44331),h=n(11375),p=n(49909),x=n(69452),g=n(27321),b=n(6474),f=n(37550);let m=[{label:"フローチャートエディタ",path:"/flow-chart"},{label:"ER図エディタ",path:"/er-diagram"}],y=()=>{var e,t;let n=null!==(e=(0,f.usePathname)())&&void 0!==e?e:"",r="/"===n,o=r?m.find(e=>"/flow-chart"===e.path):m.find(e=>n.startsWith(e.path)),l=m.filter(e=>!(r?"/flow-chart"===e.path:n.startsWith(e.path)));return(0,a.jsxs)(u.v,{children:[(0,a.jsx)(h.j,{as:p.z,variant:"outline",size:"sm",ml:{base:0,sm:"auto"},children:null!==(t=null==o?void 0:o.label)&&void 0!==t?t:"エディタを選択"}),(0,a.jsx)(x.q,{children:l.map(e=>(0,a.jsx)(g.sN,{as:b.default,href:""!==n?e.path:"#",children:e.label},e.path))})]})};var w=n(85709),j=n(57261),C=n(80010);let v=e=>{let{code:t,showLineNumbers:n=!0,minHeight:r="400px",fontSize:o="14px"}=e;return(0,a.jsx)(w.x,{w:"full",borderRadius:"md",overflow:"hidden",border:"1px solid",borderColor:"border",children:(0,a.jsx)(j.Z,{language:"mermaid",style:C.Z,showLineNumbers:n,customStyle:{margin:0,fontSize:o,minHeight:r},children:t})})}},78607:function(e,t,n){"use strict";n.r(t),n.d(t,{FlowEditor:function(){return ez}});var a=n(48983),r=n(61464),o=n(5301),l=n(24289),s=n(78091),i=n(85709),c=n(12685),d=n(79544),u=n(80834),h=n(54117),p=n(67545),x=n(21967);function g(e){let t=new Map,n=new Map;return e.forEach(e=>{var t;n.has(e.source)||n.set(e.source,new Set),null===(t=n.get(e.source))||void 0===t||t.add(e.target)}),e.forEach(e=>{var a,r;let{source:o,target:l}=e;if(null===(a=n.get(l))||void 0===a?void 0:a.has(o)){let n=o<l?"".concat(o,"-").concat(l):"".concat(l,"-").concat(o);t.has(n)||t.set(n,[]),null===(r=t.get(n))||void 0===r||r.push(e)}}),t}let b=(e,t,n,a,r)=>{let o=a.find(t=>t.source===e.source&&t.target===e.target);if(!o)return{adjustedX:t,adjustedY:n};let{offsetX:l,offsetY:s}=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;for(let[,a]of Array.from(g(t).entries())){let t=a.find(t=>t.id===e.id);if(t){let e=a.indexOf(t),r=e%2==0?1:-1,o=Math.floor(e/2+1)*n*r;if(t.target===t.source)return function(e,t,n){let a=t.filter(t=>t.source===e.source&&t.target===e.target),r=a.findIndex(t=>t.id===e.id),o=2*Math.PI/Math.max(a.length,1)*r,l=n*(1+r);return{offsetX:Math.cos(o)*l,offsetY:Math.sin(o)*l}}(t,a,n);return{offsetX:String(t.target).localeCompare(String(t.source),void 0,{numeric:!0})>0?o:-o,offsetY:o}}}return{offsetX:0,offsetY:0}}(o,a);return{adjustedX:t+l,adjustedY:n+s}},f=new Set(["end","start","subgraph","class","classDef","click","style","linkStyle","direction","flowchart","graph","if","else","elseif","while","for","function","return","break","continue"]),m=e=>{if(!e||""===e.trim())return"node_unnamed";let t=e.trim();return f.has(t.toLowerCase())&&(t="node_".concat(t)),/^[0-9]/.test(t)&&(t="_".concat(t)),t=(t=t.replace(/\s+/g,"_")).replace(/[^\w\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,"_")},y=(e,t)=>{switch(e){case"rectangle":default:return"[".concat(t,"]");case"diamond":return"{".concat(t,"}");case"rounded":return"(".concat(t,")");case"circle":return"((".concat(t,"))");case"hexagon":return"{{".concat(t,"}}");case"stadium":return"([".concat(t,"])")}},w=e=>e&&""!==e.trim()?/^\d+$/.test(e.trim())?e.trim():/^[a-zA-Z0-9\-_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF\s]+$/.test(e)?e:'"'.concat(e.replace(/"/g,'\\"'),'"'):e,j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"arrow",t=arguments.length>1?arguments[1]:void 0,n=t&&""!==t.trim(),a=n?w(t):"";switch(e){case"arrow":default:return n?" -->|".concat(a,"| "):" --> ";case"thick":return n?" ==>|".concat(a,"| "):" ==> ";case"dotted":return n?" -. ".concat(a," .-> "):" -.-> ";case"invisible":return n?" ~~~|".concat(a,"| "):" ~~~ ";case"bidirectional":return n?" <-->|".concat(a,"| "):" <--> ";case"bidirectional-thick":return n?" <==".concat(a,"==> "):" <==> "}},C=e=>{switch(e){case"arrow":default:return"→";case"thick":return"⇒";case"dotted":return"⇢";case"invisible":return"～";case"bidirectional":return"↔";case"bidirectional-thick":return"⇔"}},v=e=>{switch(e){case"arrow":default:return"通常の矢印 (->)";case"thick":return"太い矢印 (==>)";case"dotted":return"点線矢印 (-.->)";case"invisible":return"非表示 (~~~)";case"bidirectional":return"双方向矢印 (<->)";case"bidirectional-thick":return"太い双方向矢印 (<==>)"}},E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TD",n="flowchart ".concat(t,"\n");return e.nodes.forEach(e=>{let t=m(e.data.variableName||"node".concat(e.id)),a=y(e.data.shapeType||"rectangle",e.data.label||"");n+="    ".concat(t).concat(a,"\n")}),e.edges.forEach(t=>{let a=e.nodes.find(e=>e.id===t.source),r=e.nodes.find(e=>e.id===t.target);if(a&&r){var o,l;let e=m(a.data.variableName||"node".concat(a.id)),s=m(r.data.variableName||"node".concat(r.id)),i=null===(o=t.data)||void 0===o?void 0:o.label,c=j((null===(l=t.data)||void 0===l?void 0:l.arrowType)||"arrow",i);n+="    ".concat(e).concat(c).concat(s,"\n")}}),n},S=e=>{let t={nodes:[],edges:[]};if(!e||""===e.trim())return t;let n=e.split("\n").map(e=>e.trim()).filter(e=>e).filter(e=>!e.startsWith("flowchart")&&!e.startsWith("graph")),a=new Map;for(let e of n){let t=T(e);t&&a.set(t.id,t)}for(let e of n){let n=F(e);if(n){if(!a.has(n.source)){let t=k(e,n.source);a.set(n.source,t)}if(!a.has(n.target)){let t=k(e,n.target);a.set(n.target,t)}t.edges.push(n)}}return t.nodes=Array.from(a.values()),t},k=(e,t)=>{for(let{pattern:n,shape:a}of[{pattern:"\\[([^\\]]*)\\]",shape:"rectangle"},{pattern:"\\(\\(([^\\)]*)\\)\\)",shape:"circle"},{pattern:"\\{\\{([^\\}]*)\\}\\}",shape:"hexagon"},{pattern:"\\(\\[([^\\]]*)\\]\\)",shape:"stadium"},{pattern:"\\(([^\\)]*)\\)",shape:"rounded"},{pattern:"\\{([^\\}]*)\\}",shape:"diamond"}]){let r=new RegExp("".concat(t).concat(n)),o=e.match(r);if(o)return{id:t,variableName:t,label:o[1]||t,shapeType:a}}return{id:t,variableName:t,label:t,shapeType:"rectangle"}},T=e=>{if(e.includes("-->")||e.includes("==>")||e.includes("-.->")||e.includes("~~~")||e.includes("<-->")||e.includes("<==>"))return null;for(let t of[{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\[([^\]]*)\]$/,shape:"rectangle"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(\(([^)]*)\)\)$/,shape:"circle"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\{\{([^}]*)\}\}$/,shape:"hexagon"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(\[([^\]]*)\]\)$/,shape:"stadium"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\(([^)]*)\)$/,shape:"rounded"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)\{([^}]*)\}$/,shape:"diamond"},{regex:/^([a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]+)$/,shape:"rectangle"}]){let n=e.match(t.regex);if(n){let e=n[1],a=void 0!==n[2]?n[2]:e;if(e.includes(" "))continue;return{id:e,variableName:e,label:a,shapeType:t.shape}}}return null},F=e=>{let t="[a-zA-Z0-9_\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF]+",n="(?:\\[[^\\]]*\\]|\\([^)]*\\)|\\{[^}]*\\}|\\(\\([^)]*\\)\\)|\\{\\{[^}]*\\}\\}|\\(\\[[^\\]]*\\]\\))?";for(let a of[{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*<==\\s*(.+?)\\s*==>\\s*(").concat(t,")").concat(n,"$")),arrowType:"bidirectional-thick",labelPosition:"middle"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*<==>\\s*(").concat(t,")").concat(n,"$")),arrowType:"bidirectional-thick"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*<-->\\s*\\|\\s*([^|]*)\\s*\\|\\s*(").concat(t,")").concat(n,"$")),arrowType:"bidirectional"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*<--\\s*(.+?)\\s*-->\\s*(").concat(t,")").concat(n,"$")),arrowType:"bidirectional",labelPosition:"middle"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*<-->\\s*(").concat(t,")").concat(n,"$")),arrowType:"bidirectional"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*-\\.\\s*(.+?)\\s*\\.->\\s*(").concat(t,")").concat(n,"$")),arrowType:"dotted",labelPosition:"sides"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*-\\.\\s*->\\s*(").concat(t,")").concat(n,"$")),arrowType:"dotted"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*==>\\s*\\|\\s*([^|]*)\\s*\\|\\s*(").concat(t,")").concat(n,"$")),arrowType:"thick"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*==\\s*(.+?)\\s*==>\\s*(").concat(t,")").concat(n,"$")),arrowType:"thick"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*==>\\s*(").concat(t,")").concat(n,"$")),arrowType:"thick"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*-->\\s*\\|\\s*([^|]*)\\s*\\|\\s*(").concat(t,")").concat(n,"$")),arrowType:"arrow"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*--\\s*(.+?)\\s*-->\\s*(").concat(t,")").concat(n,"$")),arrowType:"arrow"},{regex:new RegExp("^(".concat(t,")").concat(n,"\\s*-->\\s*(").concat(t,")").concat(n,"$")),arrowType:"arrow"}]){let t=e.match(a.regex);if(t){let e,n;let r="";return"bidirectional-thick"===a.arrowType&&t.length>=4&&t[2]&&""!==t[2].trim()?(e=t[1],r=t[2].trim(),n=t[3]):"sides"===a.labelPosition&&t.length>=4?(e=t[1],r=t[2].trim(),n=t[3]):4===t.length?(e=t[1],r=t[2].trim(),n=t[3]):(e=t[1],n=t[2]),{id:"".concat(e,"-").concat(n),source:e,target:n,label:r,arrowType:a.arrowType}}}return null};var z=n(28043),A=n(44331),N=n(11375),D=n(10800),_=n(69452),R=n(27321);let I=["arrow","thick","dotted","invisible","bidirectional","bidirectional-thick"],M=[{type:"rectangle",label:"四角形",symbol:"[ ]"},{type:"diamond",label:"菱形",symbol:"{ }"},{type:"rounded",label:"角丸四角",symbol:"( )"},{type:"circle",label:"円形",symbol:"(( ))"},{type:"hexagon",label:"六角形",symbol:"{{ }}"},{type:"stadium",label:"スタジアム",symbol:"([ ])"}],L=e=>{let{currentArrowType:t,onArrowTypeChange:n}=e;return(0,a.jsxs)(A.v,{children:[(0,a.jsx)(N.j,{className:"arrow-type-selector-button",as:x.h,"aria-label":"Select arrow type",icon:(0,a.jsx)(z.v,{}),size:"xs",variant:"outline",bg:"white",border:"1px solid",borderColor:"gray.300",_hover:{bg:"gray.50"}}),(0,a.jsx)(D.h,{children:(0,a.jsx)(_.q,{bg:"white",boxShadow:"lg",border:"1px solid",borderColor:"gray.200",children:I.map(e=>(0,a.jsx)(R.sN,{onClick:()=>n(e),bg:t===e?"blue.50":"white",color:t===e?"blue.600":"gray.700",fontSize:"sm",children:v(e)},e))})})]})};function $(e){let{id:t,labelX:n,labelY:r,data:o}=e,[l,s]=(0,c.useState)(!1),[d,g]=(0,c.useState)((null==o?void 0:o.label)||""),[b,f]=(0,c.useState)(!1),m=(0,c.useRef)(null);(0,c.useEffect)(()=>{l&&m.current&&(m.current.focus(),m.current.select())},[l]);let y=()=>{s(!1),(null==o?void 0:o.onLabelChange)&&o.onLabelChange(t,d)};return(0,a.jsx)(i.x,{position:"absolute",transform:"translate(-50%, -50%) translate(".concat(n,"px,").concat(r,"px)"),pointerEvents:"all",className:"nodrag nopan",children:l?(0,a.jsx)(h.I,{ref:m,value:d,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"!==e.key||b?"Escape"===e.key&&(s(!1),g((null==o?void 0:o.label)||"")):y()},onBlur:()=>{y()},onCompositionStart:()=>{f(!0)},onCompositionEnd:()=>{f(!1)},size:"sm",w:"120px",bg:"white",border:"1px solid",borderColor:"gray.300",fontSize:"12px",textAlign:"center"}):(0,a.jsxs)(p.Ug,{gap:"1",align:"center",children:[(0,a.jsxs)(i.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),s(!0)},bg:"white",p:"1",px:"2",borderRadius:"md",fontSize:"xs",border:"1px solid",borderColor:"gray.300",cursor:"pointer",minW:"20px",textAlign:"center",display:"flex",alignItems:"center",gap:"1",children:[(0,a.jsx)(i.x,{as:"span",color:"blue.600",fontWeight:"bold",children:C((null==o?void 0:o.arrowType)||"arrow")}),(0,a.jsx)(i.x,{as:"span",children:d||"..."})]}),(0,a.jsx)(L,{currentArrowType:(null==o?void 0:o.arrowType)||"arrow",onArrowTypeChange:e=>{(null==o?void 0:o.onArrowTypeChange)&&o.onArrowTypeChange(t,e)}}),(0,a.jsx)(x.h,{"aria-label":"Delete edge",icon:(0,a.jsx)(u.b,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:e=>{e.preventDefault(),e.stopPropagation(),(null==o?void 0:o.onDelete)&&o.onDelete(t)},bg:"white",border:"1px solid",borderColor:"red.300",_hover:{bg:"red.50"}})]})})}let B={editableEdge:function(e){var t;let{id:n,sourceX:l,sourceY:s,targetX:i,targetY:c,sourcePosition:d,targetPosition:u,data:h,markerEnd:p,source:x,target:f}=e,{getEdges:m,getNodes:y}=(0,r.useReactFlow)(),w=m(),j=y(),C={id:n,source:x,target:f},[v,E,S]=(0,o.OQ)({sourceX:l,sourceY:s,sourcePosition:d,targetX:i,targetY:c,targetPosition:u}),{adjustedX:k,adjustedY:T}=b(C,E,S,w,j),F=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let[,a]of Array.from(g(t).entries()))if(a.some(t=>t.source===e.source&&t.target===e.target)&&n)return{stroke:"#ff6b6b",strokeOpacity:.8,strokeWidth:2};return{}}(C,w,null!==(t=null==h?void 0:h.enableCyclicEdgeStyling)&&void 0!==t&&t);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.BaseEdge,{path:v,markerEnd:p,style:F}),(0,a.jsx)(r.EdgeLabelRenderer,{children:(0,a.jsx)($,{id:n,labelX:k,labelY:T,data:h})})]})}};var P=n(68598),Z=n(38600),V=n(65292),O=n(33657),W=n(34045),H=n(75557),X=n(24187),q=n(11676),Y=n(49909),G=n(42617),K=n(13839),U=n(52020);let J=[{type:"TD",arrow:P.v},{type:"LR",arrow:Z.L},{type:"RL",arrow:V.Y},{type:"BT",arrow:O.H}],Q=e=>{let{open:t,onClose:n,flowData:r}=e,[o,s]=(0,c.useState)("TD"),i=(0,c.useMemo)(()=>E(r,o),[r,o]),d=(0,c.useCallback)(()=>{let e=document.createElement("a"),t=new Blob([i],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download="flowchart.mmd",document.body.appendChild(e),e.click(),document.body.removeChild(e)},[i]),{open:u,onOpen:h,onClose:x}=(0,l.useDisclosure)();return(0,a.jsxs)(H.u,{open:t,onClose:n,size:"2xl",children:[(0,a.jsx)(X.x,{children:(0,a.jsxs)(p.Ug,{justify:{base:"space-between",md:"flex-start"},display:{base:"flex",md:"inline-flex"},flexWrap:"wrap",alignItems:"center",children:[(0,a.jsx)(q.x,{children:"生成されたMermaidコード"}),(0,a.jsx)(Y.z,{startIcon:(0,a.jsx)(W._,{}),colorScheme:"blue",size:"sm",onClick:d,ml:{base:0,md:"auto"},children:"ダウンロード"}),(0,a.jsxs)(A.v,{open:u,onOpen:h,onClose:x,children:[(0,a.jsx)(N.j,{size:"sm",as:Y.z,rightIcon:(0,a.jsx)(z.v,{fontSize:"xl"}),children:o}),(0,a.jsx)(_.q,{children:J.map(e=>(0,a.jsx)(R.sN,{icon:(0,a.jsx)(e.arrow,{}),bgColor:e.type===o?"primary.50":"transparent",onClick:()=>s(e.type),children:e.type},e.type))})]})]})}),(0,a.jsx)(G.o,{}),(0,a.jsxs)(K.f,{pb:6,position:"relative",children:[(0,a.jsx)(U.qi,{value:i,position:"absolute",top:2,right:6,zIndex:1}),(0,a.jsx)(U.D5,{code:i})]})]})},ee=e=>{let{value:t,isEditing:n,onDoubleClick:r,onChange:o,onKeyDown:l,onCompositionStart:s,onCompositionEnd:i,onBlur:c}=e;return(0,a.jsx)(a.Fragment,{children:n?(0,a.jsx)(h.I,{value:t,onChange:o,onKeyDown:l,onCompositionStart:s,onCompositionEnd:i,onBlur:c,size:"sm",autoFocus:!0,textAlign:"center",w:"full",h:"24px",p:1,fontSize:"sm",border:"none",bg:"transparent",_focus:{boxShadow:"none",outline:"none"}}):(0,a.jsx)(q.x,{w:"full",fontSize:"sm",fontWeight:"medium",wordBreak:"break-word",lineHeight:"1.2",onDoubleClick:r,children:t})})},et=e=>{let{value:t,isEditing:n,shapeType:r,onClick:o,onChange:l,onKeyDown:s,onCompositionStart:c,onCompositionEnd:d,onBlur:u}=e,p=y(r||"rectangle",t);return(0,a.jsx)(i.x,{position:"absolute",top:"-12px",left:"0px",bg:"blue.500",color:"white",px:1,py:"1px",borderRadius:"sm",fontSize:"10px",fontWeight:"medium",cursor:"pointer",onClick:o,_hover:{bg:"blue.600"},zIndex:10,children:n?(0,a.jsx)(h.I,{value:t,onChange:l,onKeyDown:s,onCompositionStart:c,onCompositionEnd:d,onBlur:u,size:"xs",autoFocus:!0,w:"60px",h:"16px",p:0,fontSize:"10px",bg:"white",color:"black",border:"none",_focus:{boxShadow:"none",outline:"none"}}):p})};var en=n(49942),ea=n(69577),er=n(1644),eo=n(40978),el=n(59348),es=n(38280);let ei=e=>{let{currentShape:t,onShapeChange:n}=e;return(0,a.jsxs)(A.v,{children:[(0,a.jsx)(N.j,{as:R.sN,icon:(0,a.jsx)(es.o,{fontSize:"xl"}),children:"ノード形状"}),(0,a.jsx)(_.q,{children:M.map(e=>(0,a.jsx)(R.sN,{onClick:()=>null==n?void 0:n(e.type),bg:t===e.type?"primary.50":void 0,children:(0,a.jsxs)(i.x,{display:"flex",alignItems:"center",justifyContent:"space-between",w:"full",children:[(0,a.jsx)(q.x,{children:e.label}),(0,a.jsx)(q.x,{fontSize:"sm",color:"muted",fontFamily:"mono",children:e.symbol})]})},e.type))})]})},ec=e=>{let{onEdit:t,onEditVariableName:n,onDelete:r,onShapeChange:o,currentShape:l}=e;return(0,a.jsxs)(A.v,{children:[(0,a.jsx)(N.j,{size:"xs",position:"absolute",top:0,right:0,as:x.h,icon:(0,a.jsx)(en.J,{fontSize:"2xl"}),variant:"ghost"}),(0,a.jsxs)(_.q,{children:[(0,a.jsx)(R.sN,{icon:(0,a.jsx)(ea.V,{fontSize:"xl"}),onClick:t,children:"ラベル編集"}),(0,a.jsx)(R.sN,{icon:(0,a.jsx)(er.l,{fontSize:"xl"}),onClick:n,children:"変数名編集"}),(0,a.jsx)(el.C,{}),(0,a.jsx)(ei,{currentShape:l,onShapeChange:o}),(0,a.jsx)(el.C,{}),(0,a.jsx)(R.sN,{color:"danger",icon:(0,a.jsx)(eo.X,{fontSize:"xl",color:"danger"}),onClick:r,children:"削除"})]})]})},ed=e=>{let{data:t,id:n}=e,[r,o]=(0,c.useState)(!1),[l,s]=(0,c.useState)(!1),[d,u]=(0,c.useState)(t.label),[h,p]=(0,c.useState)(t.variableName||"node".concat(n)),[x,g]=(0,c.useState)(!1),b=(0,c.useRef)(0),f=()=>{Date.now()-b.current<300||(l&&y(),o(!0))},m=()=>{o(!1),t.onLabelChange&&t.onLabelChange(n,d)},y=()=>{s(!1),t.onVariableNameChange&&t.onVariableNameChange(n,h)},w=()=>{o(!1),u(t.label)},j=()=>{s(!1),p(t.variableName||"node".concat(n))},C=()=>{g(!0)},v=()=>{g(!1)};return(0,a.jsxs)(i.x,{bg:"white",border:"2px solid #1a365d",borderRadius:"md",p:2,w:"xs",minH:"6xs",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",cursor:"pointer",onDoubleClick:f,_hover:{boxShadow:"md"},position:"relative",children:[(0,a.jsx)(et,{value:h,isEditing:l,shapeType:t.shapeType,onClick:e=>{e.stopPropagation(),e.preventDefault(),b.current=Date.now(),r&&m(),s(!0)},onChange:e=>{p(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||x?"Escape"===e.key&&j():y()},onCompositionStart:C,onCompositionEnd:v,onBlur:y}),(0,a.jsx)(ec,{onDelete:()=>{t.onDelete&&t.onDelete(n)},onEdit:()=>{l&&y(),o(!0)},onEditVariableName:()=>{r&&m(),s(!0)},onShapeChange:e=>{var a;null===(a=t.onShapeTypeChange)||void 0===a||a.call(t,n,e)},currentShape:t.shapeType||"rectangle"}),(0,a.jsx)(ee,{value:d,isEditing:r,onDoubleClick:f,onChange:e=>{u(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||x?"Escape"===e.key&&w():m()},onCompositionStart:C,onCompositionEnd:v,onBlur:m})]})},eu={editableNode:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ed,{...e}),(0,a.jsx)(r.Handle,{type:"target",position:o.Ly.Top}),(0,a.jsx)(r.Handle,{type:"source",position:o.Ly.Bottom})]})};var eh=n(21431),ep=n(20557),ex=n(50807),eg=n(20333),eb=n(86899),ef=n(67589),em=n(78485),ey=n(47104);n(6372),n(50590);let ew=e=>{let{value:t,onChange:n,placeholder:r="Mermaidコードを入力...",minHeight:o="300px",fontSize:l="14px"}=e;return(0,a.jsx)(i.x,{w:"full",borderRadius:"md",overflow:"hidden",border:"1px solid",borderColor:"border",bg:"gray.900",color:"white",fontFamily:"mono",sx:{"& textarea::placeholder":{color:"white",opacity:.7}},children:(0,a.jsx)(ey.Z,{value:t,onValueChange:n,highlight:e=>{try{return(0,em.highlight)(e,em.languages.mermaid,"mermaid")}catch(t){return e.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"})[e])}},padding:16,placeholder:r,style:{fontFamily:'"Fira code", "Fira Mono", Consolas, Monaco, "Courier New", monospace',fontSize:l,minHeight:o,lineHeight:"1.5",backgroundColor:"transparent",outline:"none",caretColor:"white"}})})},ej=e=>{let{open:t,onClose:n,onImport:r}=e,[o,l]=(0,c.useState)(""),[s,i]=(0,c.useState)(null),[d,u]=(0,c.useState)(!1),h=async()=>{if(!o.trim()){i("Mermaidコードを入力してください");return}u(!0),i(null);try{let e=S(o);if(0===e.nodes.length&&0===e.edges.length){i("有効なMermaidコードが見つかりませんでした。ノードまたはエッジの定義を確認してください。");return}r(e),l(""),n()}catch(e){i("Mermaidコードの解析中にエラーが発生しました")}finally{u(!1)}},x=()=>{l(""),i(null),n()};return(0,a.jsxs)(H.u,{open:t,onClose:x,size:"2xl",children:[(0,a.jsx)(eg.Z,{}),(0,a.jsx)(X.x,{children:"Mermaidコードインポート"}),(0,a.jsx)(K.f,{children:(0,a.jsxs)(p.gC,{gap:2,children:[(0,a.jsx)(q.x,{fontSize:"sm",color:"gray.600",children:"Mermaidのフローチャートコードを貼り付けてインポートできます"}),(0,a.jsx)(ew,{value:o,onChange:e=>{l(e),i(null)},placeholder:"例:\n".concat("flowchart TD\n    A[開始] --> B{判定}\n    B -->|はい| C[処理A]\n    B -->|いいえ| D[処理B]\n    C --> E[終了]\n    D --> E"),minHeight:"300px"}),s&&(0,a.jsx)(eC,{message:s}),(0,a.jsx)(q.x,{fontSize:"xs",color:"gray.500",children:"\uD83D\uDCA1 対応しているノード形状: 四角形[label], ダイヤモンド{label}, 円((label)), 六角形{{label}}, スタジアム([label]), 角丸(label)"})]})}),(0,a.jsxs)(eb.m,{children:[(0,a.jsx)(Y.z,{onClick:x,children:"キャンセル"}),(0,a.jsx)(Y.z,{colorScheme:"blue",onClick:h,loading:d,loadingText:"インポート中...",disabled:!o.trim(),children:"インポート"})]})]})},eC=e=>{let{message:t}=e;return(0,a.jsxs)(ef.bZ,{status:"error",children:[(0,a.jsx)(ef.zM,{}),(0,a.jsx)(ef.X,{children:t})]})},ev=e=>{let{onAddNode:t,onGenerateCode:n,onImportMermaid:o}=e;return(0,a.jsx)(r.Panel,{position:"top-left",children:(0,a.jsx)(eE,{onAddNode:t,onGenerateCode:n,onImportMermaid:o})})},eE=e=>{let{onAddNode:t,onGenerateCode:n,onImportMermaid:r}=e,{open:o,onOpen:s,onClose:i}=(0,l.useDisclosure)();return(0,a.jsxs)(p.gC,{gap:4,p:4,bg:"white",borderRadius:"md",boxShadow:"md",children:[(0,a.jsxs)(p.Ug,{w:"full",display:{base:"flex",sm:"inline-flex"},flexWrap:"wrap",justify:"space-between",children:[(0,a.jsx)(q.x,{fontSize:"lg",fontWeight:"bold",children:"Mermaid フローチャート エディター"}),(0,a.jsx)(U.i9,{})]}),(0,a.jsxs)(p.gC,{gap:2,align:"start",children:[(0,a.jsx)(q.x,{fontSize:"sm",color:"gray.600",children:"\uD83D\uDCA1 ヒント: ノードをダブルクリックで編集、ドラッグして空の場所で新ノード作成"}),(0,a.jsxs)(p.Ug,{gap:2,display:{base:"flex",md:"inline-flex"},flexWrap:"wrap",children:[(0,a.jsx)(Y.z,{startIcon:(0,a.jsx)(eh.p,{}),colorScheme:"blue",size:"sm",onClick:t,children:"ノード追加"}),(0,a.jsx)(Y.z,{startIcon:(0,a.jsx)(ep.d,{}),colorScheme:"green",size:"sm",onClick:n,children:"コード生成"}),(0,a.jsx)(Y.z,{startIcon:(0,a.jsx)(ex.r,{}),colorScheme:"purple",size:"sm",onClick:s,children:"インポート"})]})]}),(0,a.jsx)(ej,{open:o,onClose:i,onImport:r})]})};function eS(e,t,n){return{id:e.toString(),type:"editableNode",position:t,data:{label:"Node ".concat(e),variableName:"node".concat(e),shapeType:"rectangle",...n}}}let ek={LEVEL_HEIGHT:150,NODE_SPACING:250,CENTER_OFFSET:300,VERTICAL_OFFSET:50},eT=[{id:"1",type:"editableNode",position:{x:250,y:5},data:{label:"Start",variableName:"startNode",shapeType:"rectangle"}}],eF=[];function ez(){let[e,t,n]=(0,r.useNodesState)(eT),[u,h,p]=(0,r.useEdgesState)(eF),[x,g]=(0,c.useState)(2),{open:b,onOpen:f,onClose:m}=(0,l.useDisclosure)(),y=(0,c.useRef)(null),{screenToFlowPosition:w}=(0,r.useReactFlow)(),j=(0,s.useToken)("sizes","xs"),C=(0,s.useToken)("sizes","6xs"),v=(e,t)=>{if(!e)return t;let n=parseFloat(e.replace("px","").replace("rem",""));return isNaN(n)?t:e.includes("rem")?16*n:n},E=v(j,80),S=v(C,48),k=(0,c.useCallback)((e,n)=>{t(t=>t.map(t=>t.id===e?{...t,data:{...t.data,label:n}}:t))},[t]),T=(0,c.useCallback)((e,n)=>{t(t=>t.map(t=>t.id===e?{...t,data:{...t.data,variableName:n}}:t))},[t]),F=(0,c.useCallback)((e,n)=>{t(t=>t.map(t=>t.id===e?{...t,data:{...t.data,shapeType:n}}:t))},[t]),z=(0,c.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e)),h(t=>t.filter(t=>t.source!==e&&t.target!==e))},[t,h]),A=(0,c.useCallback)((e,t)=>{h(n=>n.map(n=>n.id===e?{...n,data:{...n.data,label:t}}:n))},[h]),N=(0,c.useCallback)(e=>{h(t=>t.filter(t=>t.id!==e))},[h]),D=(0,c.useCallback)((e,t)=>{h(n=>n.map(n=>n.id===e?{...n,data:{...n.data,arrowType:t}}:n))},[h]);(0,c.useEffect)(()=>{t(e=>e.map(e=>({...e,data:{...e.data,onLabelChange:k,onVariableNameChange:T,onShapeTypeChange:F,onDelete:z}})))},[k,T,F,z,t]),(0,c.useEffect)(()=>{h(e=>e.map(e=>({...e,type:"editableEdge",data:{...e.data,onLabelChange:A,onArrowTypeChange:D,onDelete:N}})))},[A,D,N,h]);let _=(0,c.useCallback)(e=>{let t={...e,type:"editableEdge",data:{label:"",arrowType:"arrow",onLabelChange:A,onArrowTypeChange:D,onDelete:N}};h(e=>(0,o.Z_)(t,e)),y.current="connected"},[h,A,D,N]),R=(0,c.useCallback)((e,t)=>{y.current=t.nodeId,y.current="".concat(t.nodeId,"-").concat(t.handleType)},[]),I=(0,c.useCallback)(n=>{var a,r,o,l;if(y.current){if("connected"===y.current){y.current=null;return}if(((null==n?void 0:null===(r=n.target)||void 0===r?void 0:null===(a=r.classList)||void 0===a?void 0:a.contains("react-flow__pane"))||n&&n.target instanceof Element&&n.target.closest(".react-flow__pane"))&&n){let a,r;let{sourceNodeId:s,handleType:i}=function(e){let[t,n]=e.split("-");return{sourceNodeId:t,handleType:n}}(y.current);if(!e.find(e=>e.id===s))return;n instanceof TouchEvent&&n.changedTouches.length>0?(a=n.changedTouches[0].clientX,r=n.changedTouches[0].clientY):(a=n.clientX,r=n.clientY);let c=eS(x,{x:(o=w({x:a,y:r})).x-E/2,y:o.y-S/2},{onLabelChange:k,onVariableNameChange:T,onShapeTypeChange:F,onDelete:z});t(e=>e.concat(c));let d=(l=x.toString(),{id:"".concat(s,"-").concat(l),type:"editableEdge",source:"source"===i?s:l,target:"source"===i?l:s,data:{label:"",arrowType:"arrow",onLabelChange:A,onArrowTypeChange:D,onDelete:N}});h(e=>[...e,d]),g(x+1)}y.current=null}},[x,t,h,w,k,T,F,z,A,D,N,e,E,S]),M=(0,c.useCallback)(()=>{let e=eS(x,{x:500*Math.random(),y:500*Math.random()},{onLabelChange:k,onVariableNameChange:T,onShapeTypeChange:F,onDelete:z});t(t=>t.concat(e)),g(x+1)},[x,t,k,T,F,z]),L=(0,c.useCallback)(()=>{f()},[f]),$=(0,c.useCallback)(e=>{let n=((e,t)=>{let n=new Set(t.map(e=>e.target)),a=e.filter(e=>!n.has(e.id)),r=new Map,o=new Set,l=function(e){var n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(o.has(e))return;o.add(e);let s=null!==(n=r.get(e))&&void 0!==n?n:0;r.set(e,Math.max(s,a)),t.filter(t=>t.source===e).forEach(e=>{l(e.target,a+1)})};a.forEach(e=>l(e.id,0)),e.forEach(e=>{r.has(e.id)||r.set(e.id,0)});let s=new Map;r.forEach((e,t)=>{s.has(e)||s.set(e,[]),s.get(e).push(t)});let i=new Map;return s.forEach((e,t)=>{let n=-(e.length*ek.NODE_SPACING)/2;e.forEach((e,a)=>{i.set(e,{x:n+a*ek.NODE_SPACING+ek.CENTER_OFFSET,y:t*ek.LEVEL_HEIGHT+ek.VERTICAL_OFFSET})})}),i})(e.nodes,e.edges),a=e.nodes.map(e=>({id:e.id,type:"editableNode",position:n.get(e.id)||{x:250,y:50},data:{label:e.label,variableName:e.variableName,shapeType:e.shapeType,onLabelChange:k,onVariableNameChange:T,onShapeTypeChange:F,onDelete:z}})),r=e.edges.map(e=>({id:e.id,source:e.source,target:e.target,type:"editableEdge",data:{label:e.label,arrowType:e.arrowType,onLabelChange:A,onArrowTypeChange:D,onDelete:N}}));t(a),h(r),g(e.nodes.length+1)},[t,h,k,T,F,z,A,D,N]);return(0,a.jsxs)(i.x,{h:"100vh",w:"full",children:[(0,a.jsx)(r.ReactFlow,{nodes:e,edges:u,onNodesChange:n,onEdgesChange:p,onConnect:_,onConnectStart:R,onConnectEnd:I,nodeTypes:eu,edgeTypes:B,fitView:!0,children:(0,a.jsx)(d.f,{children:(0,a.jsx)(ev,{onAddNode:M,onGenerateCode:L,onImportMermaid:$})})}),(0,a.jsx)(Q,{open:b,onClose:m,flowData:{nodes:e,edges:u}})]})}}}]);