(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{51551:function(e,n,o){Promise.resolve().then(o.bind(o,94035)),Promise.resolve().then(o.bind(o,58071)),Promise.resolve().then(o.t.bind(o,58631,23))},94035:function(e,n,o){"use strict";o.r(n),o.d(n,{FlowEditor:function(){return $}});var t=o(14297),a=o(58071),l=o(23038),r=o(31087),i=o(26451),s=o(84922),c=o(13812),d=o(20524),u=o(52838),p=o(66959),h=o(83162),x=o(17359),b=o(99592),m=o(82278),g=o(30178),f=o(65807),C=o(34310),j=o(40197),y=o(90813);let S=e=>{let{currentShape:n,onShapeChange:o}=e;return(0,t.jsxs)(x.v,{children:[(0,t.jsx)(b.j,{as:f.sN,icon:(0,t.jsx)(j.o,{fontSize:"xl"}),children:"ノード形状"}),(0,t.jsx)(g.q,{children:[{type:"rectangle",label:"四角形",symbol:"[ ]"},{type:"diamond",label:"菱形",symbol:"{ }"},{type:"rounded",label:"角丸四角",symbol:"( )"},{type:"circle",label:"円形",symbol:"(( ))"},{type:"hexagon",label:"六角形",symbol:"{{ }}"},{type:"stadium",label:"スタジアム",symbol:"([ ])"}].map(e=>(0,t.jsx)(f.sN,{onClick:()=>null==o?void 0:o(e.type),bg:n===e.type?"primary.50":void 0,children:(0,t.jsxs)(s.x,{display:"flex",alignItems:"center",justifyContent:"space-between",w:"full",children:[(0,t.jsx)(y.x,{children:e.label}),(0,t.jsx)(y.x,{fontSize:"sm",color:"muted",fontFamily:"mono",children:e.symbol})]})},e.type))})]})},w=e=>{let{onEdit:n,onEditVariableName:o,onDelete:a,onShapeChange:l,currentShape:r}=e;return(0,t.jsxs)(x.v,{children:[(0,t.jsx)(b.j,{size:"xs",position:"absolute",top:0,right:0,as:m.h,icon:(0,t.jsx)(d.J,{fontSize:"2xl"}),variant:"ghost"}),(0,t.jsxs)(g.q,{children:[(0,t.jsx)(f.sN,{icon:(0,t.jsx)(u.V,{fontSize:"xl"}),onClick:n,children:"ラベル編集"}),(0,t.jsx)(f.sN,{icon:(0,t.jsx)(p.l,{fontSize:"xl"}),onClick:o,children:"変数名編集"}),(0,t.jsx)(C.C,{}),(0,t.jsx)(S,{currentShape:r,onShapeChange:l}),(0,t.jsx)(C.C,{}),(0,t.jsx)(f.sN,{color:"danger",icon:(0,t.jsx)(h.X,{fontSize:"xl",color:"danger"}),onClick:a,children:"削除"})]})]})};var v=o(63475);let k=new Set(["end","start","subgraph","class","classDef","click","style","linkStyle","direction","flowchart","graph","if","else","elseif","while","for","function","return","break","continue"]),N=e=>{if(!e||""===e.trim())return"node_unnamed";let n=e.trim();return k.has(n.toLowerCase())&&(n="node_".concat(n)),/^[0-9]/.test(n)&&(n="_".concat(n)),n=(n=n.replace(/\s+/g,"_")).replace(/[^\w\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,"_")},z=(e,n)=>{switch(e){case"rectangle":default:return"[".concat(n,"]");case"diamond":return"{".concat(n,"}");case"rounded":return"(".concat(n,")");case"circle":return"((".concat(n,"))");case"hexagon":return"{{".concat(n,"}}");case"stadium":return"([".concat(n,"])")}};function E(e){let{value:n,isEditing:o,shapeType:a,onClick:l,onChange:r,onKeyDown:i,onCompositionStart:c,onCompositionEnd:d,onBlur:u}=e,p=z(a||"rectangle",n);return(0,t.jsx)(s.x,{position:"absolute",top:"-12px",left:"0px",bg:"blue.500",color:"white",px:1,py:"1px",borderRadius:"sm",fontSize:"10px",fontWeight:"medium",cursor:"pointer",onClick:l,_hover:{bg:"blue.600"},zIndex:10,children:o?(0,t.jsx)(v.I,{value:n,onChange:r,onKeyDown:i,onCompositionStart:c,onCompositionEnd:d,onBlur:u,size:"xs",autoFocus:!0,w:"60px",h:"16px",p:0,fontSize:"10px",bg:"white",color:"black",border:"none",_focus:{boxShadow:"none",outline:"none"}}):p})}function D(e){let{value:n,isEditing:o,onDoubleClick:a,onChange:l,onKeyDown:r,onCompositionStart:i,onCompositionEnd:s,onBlur:c}=e;return(0,t.jsx)(t.Fragment,{children:o?(0,t.jsx)(v.I,{value:n,onChange:l,onKeyDown:r,onCompositionStart:i,onCompositionEnd:s,onBlur:c,size:"sm",autoFocus:!0,textAlign:"center",w:"full",h:"24px",p:1,fontSize:"sm",border:"none",bg:"transparent",_focus:{boxShadow:"none",outline:"none"}}):(0,t.jsx)(y.x,{w:"full",fontSize:"sm",fontWeight:"medium",wordBreak:"break-word",lineHeight:"1.2",onDoubleClick:a,children:n})})}let _={editableNode:function(e){let{data:n,id:o}=e,[r,i]=(0,c.useState)(!1),[d,u]=(0,c.useState)(!1),[p,h]=(0,c.useState)(n.label),[x,b]=(0,c.useState)(n.variableName||"node".concat(o)),[m,g]=(0,c.useState)(!1),f=(0,c.useRef)(0),C=()=>{Date.now()-f.current<300||(d&&y(),i(!0))},j=()=>{i(!1),n.onLabelChange&&n.onLabelChange(o,p)},y=()=>{u(!1),n.onVariableNameChange&&n.onVariableNameChange(o,x)},S=()=>{i(!1),h(n.label)},v=()=>{u(!1),b(n.variableName||"node".concat(o))},k=()=>{g(!0)},N=()=>{g(!1)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.x,{bg:"white",border:"2px solid #1a365d",borderRadius:"md",p:2,w:"xs",minH:"6xs",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",cursor:"pointer",onDoubleClick:C,_hover:{boxShadow:"md"},position:"relative",children:[(0,t.jsx)(E,{value:x,isEditing:d,shapeType:n.shapeType,onClick:e=>{e.stopPropagation(),e.preventDefault(),f.current=Date.now(),r&&j(),u(!0)},onChange:e=>{b(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||m?"Escape"===e.key&&v():y()},onCompositionStart:k,onCompositionEnd:N,onBlur:y}),(0,t.jsx)(w,{onDelete:()=>{n.onDelete&&n.onDelete(o)},onEdit:()=>{d&&y(),i(!0)},onEditVariableName:()=>{r&&j(),u(!0)},onShapeChange:e=>{var t;null===(t=n.onShapeTypeChange)||void 0===t||t.call(n,o,e)},currentShape:n.shapeType||"rectangle"}),(0,t.jsx)(D,{value:p,isEditing:r,onDoubleClick:C,onChange:e=>{h(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||m?"Escape"===e.key&&S():j()},onCompositionStart:k,onCompositionEnd:N,onBlur:j})]}),(0,t.jsx)(a.Handle,{type:"target",position:l.Ly.Top}),(0,t.jsx)(a.Handle,{type:"source",position:l.Ly.Bottom})]})}};var T=o(91861),F=o(81710),I=o(11253),L=o(26026);function R(e){let{onAddNode:n,onGenerateCode:o}=e;return(0,t.jsx)(a.Panel,{position:"top-left",children:(0,t.jsxs)(T.gC,{gap:4,p:4,bg:"white",borderRadius:"md",boxShadow:"md",children:[(0,t.jsx)(y.x,{fontSize:"lg",fontWeight:"bold",children:"Mermaid フローチャート エディター"}),(0,t.jsxs)(T.gC,{gap:2,align:"start",children:[(0,t.jsx)(y.x,{fontSize:"sm",color:"gray.600",children:"\uD83D\uDCA1 ヒント: ノードをダブルクリックで編集、ドラッグして空の場所で新ノード作成"}),(0,t.jsxs)(T.Ug,{gap:2,children:[(0,t.jsx)(F.z,{startIcon:(0,t.jsx)(I.p,{}),colorScheme:"blue",size:"sm",onClick:n,children:"ノード追加"}),(0,t.jsx)(F.z,{startIcon:(0,t.jsx)(L.d,{}),colorScheme:"green",size:"sm",onClick:o,children:"コード生成"})]})]})]})})}var A=o(97981),B=o(80677),V=o(31542),P=o(15213),H=o(74006),K=o(29586),M=o(11677),U=o(91255),O=o(38614),W=o(23026);let Z=(0,c.memo)((0,U.forwardRef)((e,n)=>{let{value:o,...a}=e,{hasCopied:l,onCopy:r}=(0,O.useClipboard)(o);return(0,t.jsx)(W.u,{alignItems:"center",bg:"success",display:"inline-flex",h:"8",open:l,label:"Copied!",placement:"left",zIndex:"1000",children:(0,t.jsx)(m.h,{ref:n,size:"sm",variant:"unstyled","aria-label":"Copy the code",alignItems:"center",bg:["neutral.800","neutral.900"],border:"1px solid",borderColor:l?"success":"whiteAlpha.600",color:l?"success":"whiteAlpha.600",display:"flex",icon:l?(0,t.jsx)(K.n,{fontSize:"lg"}):(0,t.jsx)(M.T,{fontSize:"md"}),justifyContent:"center",_hover:{borderColor:l?"success":"whiteAlpha.800",color:l?"success":"whiteAlpha.800"},...a,onClick:r})})}));var q=o(4699),X=o(60970);function G(e){let{code:n,showLineNumbers:o=!0,minHeight:a="400px",fontSize:l="14px"}=e;return(0,t.jsx)(s.x,{w:"full",borderRadius:"md",overflow:"hidden",border:"1px solid",borderColor:"border",children:(0,t.jsx)(q.Z,{language:"mermaid",style:X.Z,showLineNumbers:o,customStyle:{margin:0,fontSize:l,minHeight:a},children:n})})}function J(e){let{open:n,onClose:o,mermaidCode:a}=e,l=(0,c.useCallback)(()=>{let e=document.createElement("a"),n=new Blob([a],{type:"text/plain"});e.href=URL.createObjectURL(n),e.download="flowchart.mmd",document.body.appendChild(e),e.click(),document.body.removeChild(e)},[a]);return(0,t.jsxs)(A.u,{open:n,onClose:o,size:"2xl",children:[(0,t.jsx)(B.x,{children:(0,t.jsxs)(T.Ug,{justify:"space-between",children:[(0,t.jsx)(y.x,{children:"生成されたMermaidコード"}),(0,t.jsx)(F.z,{startIcon:(0,t.jsx)(H._,{}),colorScheme:"blue",size:"sm",onClick:l,children:"ダウンロード"})]})}),(0,t.jsx)(V.o,{}),(0,t.jsxs)(P.f,{pb:6,position:"relative",children:[(0,t.jsx)(Z,{value:a,position:"absolute",top:2,right:6,zIndex:1}),(0,t.jsx)(G,{code:a})]})]})}let Y=[{id:"1",type:"editableNode",position:{x:250,y:5},data:{label:"Start",variableName:"startNode",shapeType:"rectangle"}}],Q=[];function $(){let[e,n,o]=(0,a.useNodesState)(Y),[d,u,p]=(0,a.useEdgesState)(Q),[h,x]=(0,c.useState)(2),{open:b,onOpen:m,onClose:g}=(0,r.useDisclosure)(),[f,C]=(0,c.useState)(""),j=(0,c.useRef)(null),{screenToFlowPosition:y}=(0,a.useReactFlow)(),S=(0,i.useToken)("sizes","xs"),w=(0,i.useToken)("sizes","6xs"),v=(e,n)=>{if(!e)return n;let o=parseFloat(e.replace("px","").replace("rem",""));return isNaN(o)?n:e.includes("rem")?16*o:o},k=v(S,80),E=v(w,48),D=(0,c.useCallback)((e,o)=>{n(n=>n.map(n=>n.id===e?{...n,data:{...n.data,label:o}}:n))},[n]),T=(0,c.useCallback)((e,o)=>{n(n=>n.map(n=>n.id===e?{...n,data:{...n.data,variableName:o}}:n))},[n]),F=(0,c.useCallback)((e,o)=>{n(n=>n.map(n=>n.id===e?{...n,data:{...n.data,shapeType:o}}:n))},[n]),I=(0,c.useCallback)(e=>{n(n=>n.filter(n=>n.id!==e)),u(n=>n.filter(n=>n.source!==e&&n.target!==e))},[n,u]);(0,c.useEffect)(()=>{n(e=>e.map(e=>({...e,data:{...e.data,onLabelChange:D,onVariableNameChange:T,onShapeTypeChange:F,onDelete:I}})))},[D,T,F,I,n]);let L=(0,c.useCallback)(e=>{u(n=>(0,l.Z_)(e,n)),j.current="connected"},[u]),A=(0,c.useCallback)((e,n)=>{j.current=n.nodeId,j.current="".concat(n.nodeId,"-").concat(n.handleType)},[]),B=(0,c.useCallback)(o=>{var t,a;if(j.current){if("connected"===j.current){j.current=null;return}if((null==o?void 0:null===(a=o.target)||void 0===a?void 0:null===(t=a.classList)||void 0===t?void 0:t.contains("react-flow__pane"))&&o){let[t,a]=j.current.split("-");if(!e.find(e=>e.id===t))return;let l=y({x:o.clientX,y:o.clientY}),r={x:l.x-k/2,y:l.y-E/2},i={id:h.toString(),type:"editableNode",position:r,data:{label:"Node ".concat(h),variableName:"node".concat(h),shapeType:"rectangle",onLabelChange:D,onVariableNameChange:T,onShapeTypeChange:F,onDelete:I}};n(e=>e.concat(i));let s={id:"".concat(t,"-").concat(h),source:"source"===a?t:h.toString(),target:"source"===a?h.toString():t};u(e=>[...e,s]),x(h+1)}j.current=null}},[h,n,u,y,D,T,F,I,e,k,E]),V=(0,c.useCallback)(()=>{let e={id:h.toString(),type:"editableNode",position:{x:500*Math.random(),y:500*Math.random()},data:{label:"Node ".concat(h),variableName:"node".concat(h),shapeType:"rectangle",onLabelChange:D,onVariableNameChange:T,onShapeTypeChange:F,onDelete:I}};n(n=>n.concat(e)),x(h+1)},[h,n,D,T,F,I]),P=(0,c.useCallback)(()=>{let n="flowchart TD\n";e.forEach(e=>{let o=N(e.data.variableName||"node".concat(e.id)),t=z(e.data.shapeType||"rectangle",e.data.label||"");n+="    ".concat(o).concat(t,"\n")}),d.forEach(o=>{let t=e.find(e=>e.id===o.source),a=e.find(e=>e.id===o.target);if(t&&a){let e=N(t.data.variableName||"node".concat(t.id)),o=N(a.data.variableName||"node".concat(a.id));n+="    ".concat(e," --> ").concat(o,"\n")}}),C(n),m()},[e,d,m]);return(0,t.jsxs)(s.x,{h:"100vh",w:"full",children:[(0,t.jsxs)(a.ReactFlow,{nodes:e,edges:d,onNodesChange:o,onEdgesChange:p,onConnect:L,onConnectStart:A,onConnectEnd:B,nodeTypes:_,fitView:!0,children:[(0,t.jsx)(a.Controls,{}),(0,t.jsx)(a.Background,{}),(0,t.jsx)(R,{onAddNode:V,onGenerateCode:P})]}),(0,t.jsx)(J,{open:b,onClose:g,mermaidCode:f})]})}}},function(e){e.O(0,[868,616,62,402,444,681,452,744],function(){return e(e.s=51551)}),_N_E=e.O()}]);