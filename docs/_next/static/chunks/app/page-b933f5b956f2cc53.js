(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{51551:function(e,n,t){Promise.resolve().then(t.bind(t,25396)),Promise.resolve().then(t.bind(t,58071)),Promise.resolve().then(t.t.bind(t,58631,23))},25396:function(e,n,t){"use strict";t.r(n),t.d(n,{FlowEditor:function(){return K}});var o=t(14297),a=t(58071),l=t(23038),r=t(31087),i=t(26451),s=t(84922),c=t(13812),d=t(63475),u=t(90813),h=t(20524),x=t(52838),p=t(66959),b=t(83162),m=t(17359),f=t(99592),g=t(82278),C=t(30178),j=t(65807);let w=e=>{let{onEdit:n,onEditVariableName:t,onDelete:a}=e;return(0,o.jsxs)(m.v,{children:[(0,o.jsx)(f.j,{size:"xs",position:"absolute",top:0,right:0,as:g.h,icon:(0,o.jsx)(h.J,{fontSize:"2xl"}),variant:"ghost"}),(0,o.jsxs)(C.q,{children:[(0,o.jsx)(j.sN,{icon:(0,o.jsx)(x.V,{fontSize:"xl"}),onClick:n,children:"ラベル編集"}),(0,o.jsx)(j.sN,{icon:(0,o.jsx)(p.l,{fontSize:"xl"}),onClick:t,children:"変数名編集"}),(0,o.jsx)(j.sN,{color:"danger",icon:(0,o.jsx)(b.X,{fontSize:"xl",color:"danger"}),onClick:a,children:"削除"})]})]})},S={editableNode:function(e){let{data:n,id:t}=e,[r,i]=(0,c.useState)(!1),[h,x]=(0,c.useState)(!1),[p,b]=(0,c.useState)(n.label),[m,f]=(0,c.useState)(n.variableName||"node".concat(t)),[g,C]=(0,c.useState)(!1),j=(0,c.useRef)(0),S=()=>{i(!1),n.onLabelChange&&n.onLabelChange(t,p)},v=()=>{x(!1),n.onVariableNameChange&&n.onVariableNameChange(t,m)},y=()=>{i(!1),b(n.label)},k=()=>{x(!1),f(n.variableName||"node".concat(t))},N=()=>{C(!0)},z=()=>{C(!1)};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(s.x,{bg:"white",border:"2px solid #1a365d",borderRadius:"md",p:2,w:"xs",minH:"6xs",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",cursor:"pointer",onDoubleClick:()=>{Date.now()-j.current<300||(h&&v(),i(!0))},_hover:{boxShadow:"md"},position:"relative",children:[(0,o.jsx)(s.x,{position:"absolute",top:"-12px",left:"0px",bg:"blue.500",color:"white",px:1,py:"1px",borderRadius:"sm",fontSize:"10px",fontWeight:"medium",cursor:"pointer",onClick:e=>{e.stopPropagation(),e.preventDefault(),j.current=Date.now(),r&&S(),x(!0)},_hover:{bg:"blue.600"},zIndex:10,children:h?(0,o.jsx)(d.I,{value:m,onChange:e=>{f(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||g?"Escape"===e.key&&k():v()},onCompositionStart:N,onCompositionEnd:z,onBlur:v,size:"xs",autoFocus:!0,w:"60px",h:"16px",p:0,fontSize:"10px",bg:"white",color:"black",border:"none",_focus:{boxShadow:"none",outline:"none"}}):n.variableName||"node".concat(t)}),(0,o.jsx)(w,{onDelete:()=>{n.onDelete&&n.onDelete(t)},onEdit:()=>{h&&v(),i(!0)},onEditVariableName:()=>{r&&S(),x(!0)}}),r?(0,o.jsx)(d.I,{value:p,onChange:e=>{b(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||g?"Escape"===e.key&&y():S()},onCompositionStart:N,onCompositionEnd:z,onBlur:S,size:"sm",autoFocus:!0,textAlign:"center",w:"full",h:"24px",p:1,fontSize:"sm",border:"none",bg:"transparent",_focus:{boxShadow:"none",outline:"none"}}):(0,o.jsx)(u.x,{w:"full",fontSize:"sm",fontWeight:"medium",wordBreak:"break-word",lineHeight:"1.2",children:p})]}),(0,o.jsx)(a.Handle,{type:"target",position:l.Ly.Top}),(0,o.jsx)(a.Handle,{type:"source",position:l.Ly.Bottom})]})}};var v=t(91861),y=t(81710),k=t(11253),N=t(26026);function z(e){let{onAddNode:n,onGenerateCode:t}=e;return(0,o.jsx)(a.Panel,{position:"top-left",children:(0,o.jsxs)(v.gC,{gap:4,p:4,bg:"white",borderRadius:"md",boxShadow:"md",children:[(0,o.jsx)(u.x,{fontSize:"lg",fontWeight:"bold",children:"Mermaid フローチャート エディター"}),(0,o.jsxs)(v.gC,{gap:2,align:"start",children:[(0,o.jsx)(u.x,{fontSize:"sm",color:"gray.600",children:"\uD83D\uDCA1 ヒント: ノードをダブルクリックで編集、ドラッグして空の場所で新ノード作成"}),(0,o.jsxs)(v.Ug,{gap:2,children:[(0,o.jsx)(y.z,{startIcon:(0,o.jsx)(k.p,{}),colorScheme:"blue",size:"sm",onClick:n,children:"ノード追加"}),(0,o.jsx)(y.z,{startIcon:(0,o.jsx)(N.d,{}),colorScheme:"green",size:"sm",onClick:t,children:"コード生成"})]})]})]})})}var E=t(97981),_=t(80677),D=t(31542),F=t(15213),I=t(81301),L=t(74006),A=t(29586),R=t(11677),V=t(91255),T=t(38614),B=t(23026);let P=(0,c.memo)((0,V.forwardRef)((e,n)=>{let{value:t,...a}=e,{hasCopied:l,onCopy:r}=(0,T.useClipboard)(t);return(0,o.jsx)(B.u,{alignItems:"center",bg:"success",display:"inline-flex",h:"8",open:l,label:"Copied!",placement:"left",zIndex:"1000",children:(0,o.jsx)(g.h,{ref:n,size:"sm",variant:"unstyled","aria-label":"Copy the code",alignItems:"center",bg:["neutral.800","neutral.900"],border:"1px solid",borderColor:l?"success":"whiteAlpha.600",color:l?"success":"whiteAlpha.600",display:"flex",icon:l?(0,o.jsx)(A.n,{fontSize:"lg"}):(0,o.jsx)(R.T,{fontSize:"md"}),justifyContent:"center",_hover:{borderColor:l?"success":"whiteAlpha.800",color:l?"success":"whiteAlpha.800"},...a,onClick:r})})}));function H(e){let{open:n,onClose:t,mermaidCode:a}=e,l=(0,c.useCallback)(()=>{let e=document.createElement("a"),n=new Blob([a],{type:"text/plain"});e.href=URL.createObjectURL(n),e.download="flowchart.mmd",document.body.appendChild(e),e.click(),document.body.removeChild(e)},[a]);return(0,o.jsxs)(E.u,{open:n,onClose:t,size:"2xl",children:[(0,o.jsx)(_.x,{children:(0,o.jsxs)(v.Ug,{justify:"space-between",children:[(0,o.jsx)(u.x,{children:"生成されたMermaidコード"}),(0,o.jsx)(y.z,{startIcon:(0,o.jsx)(L._,{}),colorScheme:"blue",size:"sm",onClick:l,children:"ダウンロード"})]})}),(0,o.jsx)(D.o,{}),(0,o.jsxs)(F.f,{pb:6,position:"relative",children:[(0,o.jsx)(P,{value:a,position:"absolute",top:2,right:6,zIndex:1}),(0,o.jsx)(I.g,{value:a,readOnly:!0,rows:15,fontFamily:"mono",fontSize:"sm"})]})]})}let M=new Set(["end","start","subgraph","class","classDef","click","style","linkStyle","direction","flowchart","graph","if","else","elseif","while","for","function","return","break","continue"]),O=e=>{if(!e||""===e.trim())return"node_unnamed";let n=e.trim();return M.has(n.toLowerCase())&&(n="node_".concat(n)),/^[0-9]/.test(n)&&(n="_".concat(n)),n=(n=n.replace(/\s+/g,"_")).replace(/[^\w\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,"_")},U=[{id:"1",type:"editableNode",position:{x:250,y:5},data:{label:"Start",variableName:"startNode"}}],W=[];function K(){let[e,n,t]=(0,a.useNodesState)(U),[d,u,h]=(0,a.useEdgesState)(W),[x,p]=(0,c.useState)(2),{open:b,onOpen:m,onClose:f}=(0,r.useDisclosure)(),[g,C]=(0,c.useState)(""),j=(0,c.useRef)(null),{screenToFlowPosition:w}=(0,a.useReactFlow)(),v=(0,i.useToken)("sizes","xs"),y=(0,i.useToken)("sizes","6xs"),k=(e,n)=>{if(!e)return n;let t=parseFloat(e.replace("px","").replace("rem",""));return isNaN(t)?n:e.includes("rem")?16*t:t},N=k(v,80),E=k(y,48),_=(0,c.useCallback)((e,t)=>{n(n=>n.map(n=>n.id===e?{...n,data:{...n.data,label:t}}:n))},[n]),D=(0,c.useCallback)((e,t)=>{n(n=>n.map(n=>n.id===e?{...n,data:{...n.data,variableName:t}}:n))},[n]),F=(0,c.useCallback)(e=>{n(n=>n.filter(n=>n.id!==e)),u(n=>n.filter(n=>n.source!==e&&n.target!==e))},[n,u]);(0,c.useEffect)(()=>{n(e=>e.map(e=>({...e,data:{...e.data,onLabelChange:_,onVariableNameChange:D,onDelete:F}})))},[_,D,F,n]);let I=(0,c.useCallback)(e=>{u(n=>(0,l.Z_)(e,n)),j.current="connected"},[u]),L=(0,c.useCallback)((e,n)=>{j.current=n.nodeId,j.current="".concat(n.nodeId,"-").concat(n.handleType)},[]),A=(0,c.useCallback)(t=>{var o,a;if(j.current){if("connected"===j.current){j.current=null;return}if(null===(a=t.target)||void 0===a?void 0:null===(o=a.classList)||void 0===o?void 0:o.contains("react-flow__pane")){let[o,a]=j.current.split("-");if(!e.find(e=>e.id===o))return;let l=w({x:t.clientX,y:t.clientY}),r={x:l.x-N/2,y:l.y-E/2},i={id:x.toString(),type:"editableNode",position:r,data:{label:"Node ".concat(x),variableName:"node".concat(x),onLabelChange:_,onVariableNameChange:D,onDelete:F}};n(e=>e.concat(i));let s={id:"".concat(o,"-").concat(x),source:"source"===a?o:x.toString(),target:"source"===a?x.toString():o};u(e=>[...e,s]),p(x+1)}j.current=null}},[x,n,u,w,_,e,N,E]),R=(0,c.useCallback)(()=>{let e={id:x.toString(),type:"editableNode",position:{x:500*Math.random(),y:500*Math.random()},data:{label:"Node ".concat(x),variableName:"node".concat(x),onLabelChange:_,onVariableNameChange:D,onDelete:F}};n(n=>n.concat(e)),p(x+1)},[x,n,_,D,F]),V=(0,c.useCallback)(()=>{let n="flowchart TD\n";e.forEach(e=>{let t=O(e.data.variableName||"node".concat(e.id));n+="    ".concat(t,"[").concat(e.data.label,"]\n")}),d.forEach(t=>{let o=e.find(e=>e.id===t.source),a=e.find(e=>e.id===t.target);if(o&&a){let e=O(o.data.variableName||"node".concat(o.id)),t=O(a.data.variableName||"node".concat(a.id));n+="    ".concat(e," --> ").concat(t,"\n")}}),C(n),m()},[e,d,m]);return(0,o.jsxs)(s.x,{h:"100vh",w:"full",children:[(0,o.jsxs)(a.ReactFlow,{nodes:e,edges:d,onNodesChange:t,onEdgesChange:h,onConnect:I,onConnectStart:L,onConnectEnd:A,nodeTypes:S,fitView:!0,children:[(0,o.jsx)(a.Controls,{}),(0,o.jsx)(a.Background,{}),(0,o.jsx)(z,{onAddNode:R,onGenerateCode:V})]}),(0,o.jsx)(H,{open:b,onClose:f,mermaidCode:g})]})}}},function(e){e.O(0,[868,616,62,448,290,681,452,744],function(){return e(e.s=51551)}),_N_E=e.O()}]);