(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{51551:function(e,n,t){Promise.resolve().then(t.bind(t,53523)),Promise.resolve().then(t.bind(t,58071)),Promise.resolve().then(t.t.bind(t,58631,23))},53523:function(e,n,t){"use strict";t.r(n),t.d(n,{FlowEditor:function(){return P}});var o=t(14297),l=t(58071),s=t(23038),r=t(31087),a=t(84922),i=t(13812),c=t(63475),d=t(90813),u=t(20524),x=t(52838),h=t(83162),p=t(17359),b=t(99592),f=t(82278),g=t(30178),j=t(65807);let m=e=>{let{onEdit:n,onDelete:t}=e;return(0,o.jsxs)(p.v,{children:[(0,o.jsx)(b.j,{size:"xs",position:"absolute",top:0,right:0,as:f.h,icon:(0,o.jsx)(u.J,{fontSize:"2xl"}),variant:"ghost"}),(0,o.jsxs)(g.q,{children:[(0,o.jsx)(j.sN,{icon:(0,o.jsx)(x.V,{fontSize:"xl"}),onClick:n,children:"編集"}),(0,o.jsx)(j.sN,{color:"danger",icon:(0,o.jsx)(h.X,{fontSize:"xl",color:"danger"}),onClick:t,children:"削除"})]})]})},C={editableNode:function(e){let{data:n,id:t}=e,[r,u]=(0,i.useState)(!1),[x,h]=(0,i.useState)(n.label),p=()=>{u(!1),n.onLabelChange&&n.onLabelChange(t,x)};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a.x,{bg:"white",border:"2px solid #1a365d",borderRadius:"md",p:2,w:"xs",minH:"6xs",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",cursor:"pointer",onDoubleClick:()=>{u(!0)},_hover:{boxShadow:"md"},position:"relative",children:[(0,o.jsx)(m,{onDelete:()=>{n.onDelete&&n.onDelete(t)},onEdit:()=>{u(!0)}}),r?(0,o.jsx)(c.I,{value:x,onChange:e=>{h(e.target.value)},onBlur:p,onKeyDown:e=>{"Enter"===e.key&&p()},size:"sm",autoFocus:!0,textAlign:"center",border:"none",w:"100px",h:"24px",p:0,bg:"transparent",_focus:{boxShadow:"none",outline:"none"}}):(0,o.jsx)(d.x,{w:"100px",fontSize:"sm",fontWeight:"medium",wordBreak:"break-word",lineHeight:"1.2",children:x})]}),(0,o.jsx)(l.Handle,{type:"target",position:s.Ly.Top}),(0,o.jsx)(l.Handle,{type:"source",position:s.Ly.Bottom})]})}};var w=t(91861),y=t(81710),S=t(11253),v=t(26026);function k(e){let{onAddNode:n,onGenerateCode:t}=e;return(0,o.jsx)(l.Panel,{position:"top-left",children:(0,o.jsxs)(w.gC,{gap:4,p:4,bg:"white",borderRadius:"md",boxShadow:"md",children:[(0,o.jsx)(d.x,{fontSize:"lg",fontWeight:"bold",children:"Mermaid フローチャート エディター"}),(0,o.jsxs)(w.gC,{gap:2,align:"start",children:[(0,o.jsx)(d.x,{fontSize:"sm",color:"gray.600",children:"\uD83D\uDCA1 ヒント: ノードをダブルクリックで編集、ドラッグして空の場所で新ノード作成"}),(0,o.jsxs)(w.Ug,{gap:2,children:[(0,o.jsx)(y.z,{startIcon:(0,o.jsx)(S.p,{}),colorScheme:"blue",size:"sm",onClick:n,children:"ノード追加"}),(0,o.jsx)(y.z,{startIcon:(0,o.jsx)(v.d,{}),colorScheme:"green",size:"sm",onClick:t,children:"コード生成"})]})]})]})})}var z=t(97981),N=t(80677),D=t(31542),E=t(15213),_=t(81301),I=t(74006),L=t(29586),A=t(11677),R=t(91255),F=t(38614),B=t(23026);let T=(0,i.memo)((0,R.forwardRef)((e,n)=>{let{value:t,...l}=e,{hasCopied:s,onCopy:r}=(0,F.useClipboard)(t);return(0,o.jsx)(B.u,{alignItems:"center",bg:"success",display:"inline-flex",h:"8",open:s,label:"Copied!",placement:"left",zIndex:"1000",children:(0,o.jsx)(f.h,{ref:n,size:"sm",variant:"unstyled","aria-label":"Copy the code",alignItems:"center",bg:["neutral.800","neutral.900"],border:"1px solid",borderColor:s?"success":"whiteAlpha.600",color:s?"success":"whiteAlpha.600",display:"flex",icon:s?(0,o.jsx)(L.n,{fontSize:"lg"}):(0,o.jsx)(A.T,{fontSize:"md"}),justifyContent:"center",_hover:{borderColor:s?"success":"whiteAlpha.800",color:s?"success":"whiteAlpha.800"},...l,onClick:r})})}));function H(e){let{open:n,onClose:t,mermaidCode:l}=e,s=(0,i.useCallback)(()=>{let e=document.createElement("a"),n=new Blob([l],{type:"text/plain"});e.href=URL.createObjectURL(n),e.download="flowchart.mmd",document.body.appendChild(e),e.click(),document.body.removeChild(e)},[l]);return(0,o.jsxs)(z.u,{open:n,onClose:t,size:"2xl",children:[(0,o.jsx)(N.x,{children:(0,o.jsxs)(w.Ug,{justify:"space-between",children:[(0,o.jsx)(d.x,{children:"生成されたMermaidコード"}),(0,o.jsx)(y.z,{startIcon:(0,o.jsx)(I._,{}),colorScheme:"blue",size:"sm",onClick:s,children:"ダウンロード"})]})}),(0,o.jsx)(D.o,{}),(0,o.jsxs)(E.f,{pb:6,position:"relative",children:[(0,o.jsx)(T,{value:l,position:"absolute",top:2,right:6,zIndex:1}),(0,o.jsx)(_.g,{value:l,readOnly:!0,rows:15,fontFamily:"mono",fontSize:"sm"})]})]})}let M=[{id:"1",type:"editableNode",position:{x:250,y:5},data:{label:"Start",variableName:"start"}}],O=[];function P(){let[e,n,t]=(0,l.useNodesState)(M),[c,d,u]=(0,l.useEdgesState)(O),[x,h]=(0,i.useState)(2),{open:p,onOpen:b,onClose:f}=(0,r.useDisclosure)(),[g,j]=(0,i.useState)(""),m=(0,i.useRef)(null),{screenToFlowPosition:w}=(0,l.useReactFlow)(),y=(0,i.useCallback)((e,t)=>{n(n=>n.map(n=>n.id===e?{...n,data:{...n.data,label:t}}:n))},[n]),S=(0,i.useCallback)(e=>{n(n=>n.filter(n=>n.id!==e)),d(n=>n.filter(n=>n.source!==e&&n.target!==e))},[n,d]);(0,i.useEffect)(()=>{n(e=>e.map(e=>({...e,data:{...e.data,onLabelChange:y,onDelete:S}})))},[y,S,n]);let v=(0,i.useCallback)(e=>{d(n=>(0,s.Z_)(e,n)),m.current="connected"},[d]),z=(0,i.useCallback)((e,n)=>{m.current=n.nodeId,m.current="".concat(n.nodeId,"-").concat(n.handleType)},[]),N=(0,i.useCallback)(t=>{var o,l;if(m.current){if("connected"===m.current){m.current=null;return}if(null===(l=t.target)||void 0===l?void 0:null===(o=l.classList)||void 0===o?void 0:o.contains("react-flow__pane")){let[o,l]=m.current.split("-");if(!e.find(e=>e.id===o))return;let s=w({x:t.clientX,y:t.clientY}),r={x:s.x-60,y:s.y-20},a={id:x.toString(),type:"editableNode",position:r,data:{label:"Node ".concat(x),onLabelChange:y,onDelete:S}};n(e=>e.concat(a));let i={id:"".concat(o,"-").concat(x),source:"source"===l?o:x.toString(),target:"source"===l?x.toString():o};d(e=>[...e,i]),h(x+1)}m.current=null}},[x,n,d,w,y,e]),D=(0,i.useCallback)(()=>{let e={id:x.toString(),type:"editableNode",position:{x:500*Math.random(),y:500*Math.random()},data:{label:"Node ".concat(x),onLabelChange:y,onDelete:S}};n(n=>n.concat(e)),h(x+1)},[x,n,y,S]),E=(0,i.useCallback)(()=>{let n="flowchart TD\n";e.forEach(e=>{n+="    ".concat(e.id,"[").concat(e.data.label,"]\n")}),c.forEach(e=>{n+="    ".concat(e.source," --> ").concat(e.target,"\n")}),j(n),b()},[e,c,b]);return(0,o.jsxs)(a.x,{h:"100vh",w:"full",children:[(0,o.jsxs)(l.ReactFlow,{nodes:e,edges:c,onNodesChange:t,onEdgesChange:u,onConnect:v,onConnectStart:z,onConnectEnd:N,nodeTypes:C,fitView:!0,children:[(0,o.jsx)(l.Controls,{}),(0,o.jsx)(l.Background,{}),(0,o.jsx)(k,{onAddNode:D,onGenerateCode:E})]}),(0,o.jsx)(H,{open:p,onClose:f,mermaidCode:g})]})}}},function(e){e.O(0,[868,616,62,882,773,681,452,744],function(){return e(e.s=51551)}),_N_E=e.O()}]);